{"version":3,"sources":["../../src/test/log-write-stream.ts","../../src/bin2text.ts","../../src/logger.ts","../../src/option.ts","../../src/log-level-impl.ts","../../src/logger-impl.ts","../../src/utils/relative-path.ts","../../src/uri.ts","../../src/log-writer-impl.ts","../../src/test/mock-logger.ts"],"sourcesContent":["import { FanoutWriteStream } from \"../utils/fanout-write-stream.js\";\nimport { Future } from \"../future.js\";\nimport { TxtEnDecoder, TxtEnDecoderSingleton } from \"../txt-en-decoder.js\";\n\nexport class LogWriteStream implements WritableStreamDefaultWriter<Uint8Array> {\n  private readonly _bufferArr: Uint8Array[];\n\n  constructor(bufferArr: Uint8Array[]) {\n    this._bufferArr = bufferArr;\n  }\n\n  readonly _resolveClosed: Future<undefined> = new Future<undefined>();\n  readonly closed: Promise<undefined> = this._resolveClosed.asPromise();\n  readonly desiredSize: number | null = null;\n  readonly ready: Promise<undefined> = Promise.resolve(undefined);\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars, @typescript-eslint/no-explicit-any\n  abort(reason?: any): Promise<void> {\n    throw new Error(\"Method not implemented.\");\n  }\n  async close(): Promise<void> {\n    await this.closed;\n    return Promise.resolve(undefined);\n  }\n  releaseLock(): void {\n    // do nothing\n  }\n  async write(chunk?: Uint8Array): Promise<void> {\n    if (chunk) {\n      this._bufferArr.push(chunk);\n    }\n    return Promise.resolve(undefined);\n  }\n}\n\nexport class LogCollector implements WritableStream<Uint8Array> {\n  readonly locked: boolean = false;\n  private _writer?: FanoutWriteStream;\n  private readonly _pass?: WritableStreamDefaultWriter<Uint8Array>;\n  private readonly _bufferArr: Uint8Array[] = [];\n  private readonly _txtEnDe: TxtEnDecoder;\n\n  constructor(pass?: WritableStreamDefaultWriter<Uint8Array>, txtEnDe?: TxtEnDecoder) {\n    this._pass = pass;\n    this._txtEnDe = txtEnDe || TxtEnDecoderSingleton();\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  abort(reason?: Uint8Array): Promise<void> {\n    throw new Error(\"Method not implemented.\");\n  }\n\n  async close(): Promise<void> {\n    if (this._writer) {\n      const ret = await this._writer.close();\n      this._writer = undefined;\n      return ret;\n    }\n    return Promise.resolve(undefined);\n  }\n\n  getWriter(): WritableStreamDefaultWriter<Uint8Array> {\n    if (!this._writer) {\n      const dests: WritableStreamDefaultWriter<Uint8Array>[] = [new LogWriteStream(this._bufferArr)];\n      if (this._pass) {\n        dests.push(this._pass);\n      }\n      this._writer = new FanoutWriteStream(dests);\n    }\n    return this._writer;\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  Logs(notJsonLine = false): any[] {\n    if (!this._writer) {\n      return [];\n    }\n    const jsonNlStr = this._txtEnDe.decode(\n      new Uint8Array(\n        (function* (res: Uint8Array[]): Generator<number, void, undefined> {\n          for (const x of res) {\n            yield* x;\n          }\n        })(this._bufferArr),\n      ),\n    );\n    if (!notJsonLine) {\n      const splitStr = jsonNlStr.split(\"\\n\");\n      const filterStr = splitStr.filter((a) => a.length);\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n      const mapStr = filterStr.map((a) => JSON.parse(a));\n      return mapStr;\n    }\n    return jsonNlStr.split(\"\\n\").filter((a) => a.length);\n  }\n}\n","export function bin2text(hex: ArrayBufferView, lineFn: (line: string) => void, size = 0): void {\n  const arr = new Uint8Array(hex.buffer, hex.byteOffset, hex.byteLength);\n  let cutted = \"  \";\n  if (size == 0) {\n    size = arr.length;\n  }\n  size = Math.min(size, arr.length);\n  const cols = 16;\n  for (let line = 0; line < size; line += cols) {\n    if (line + cols <= size || arr.length == size) {\n      // normal line\n    } else {\n      line = arr.length - (arr.length % cols);\n      size = arr.length;\n      cutted = \">>\";\n    }\n    const l: string[] = [line.toString(16).padStart(4, \"0\"), cutted];\n    for (let col = 0; col < cols; col++) {\n      if (line + col < size) {\n        l.push(arr[line + col].toString(16).padStart(2, \"0\"));\n      } else {\n        l.push(\"  \");\n      }\n      // l.push((col > 0 && col % 4 === 3) ? \" \" : \" \");\n      l.push(\" \");\n    }\n    for (let col = 0; col < cols; col++) {\n      if (line + col < size) {\n        const ch = arr[line + col];\n        l.push(ch >= 32 && ch < 127 ? String.fromCharCode(ch) : \".\");\n      }\n    }\n    lineFn(l.join(\"\"));\n  }\n}\n\nexport function bin2string(hex: ArrayBufferView, size = 0): string {\n  const collector: string[] = [];\n  bin2text(\n    hex,\n    (line) => {\n      collector.push(line);\n    },\n    size,\n  );\n  return collector.join(\"\\n\");\n}\n","import { bin2string } from \"./bin2text.js\";\nimport { Option } from \"./option.js\";\nimport { Result } from \"./result.js\";\nimport { TxtEnDecoder } from \"./txt-en-decoder.js\";\nimport { CoerceURI } from \"./uri.js\";\n\nexport const Level = {\n  WARN: \"warn\",\n  DEBUG: \"debug\",\n  INFO: \"info\",\n  ERROR: \"error\",\n};\n\nexport type Level = (typeof Level)[keyof typeof Level];\n\nexport type Serialized = string | number | boolean;\nexport type FnSerialized = () => Serialized | Serialized[];\n\nexport class LogValue {\n  constructor(readonly fn: FnSerialized) {}\n  value(): Serialized | Serialized[] {\n    try {\n      // console.log(\"LogValue.value\", this.fn.toString());\n      return this.fn();\n    } catch (e) {\n      return `LogValue:${(e as Error).message}`;\n    }\n  }\n  toJSON(): Serialized | Serialized[] {\n    return this.value();\n  }\n}\n\nexport type LogSerializable = Record<string, LogValue | Promise<LogValue>>;\n\n// export function sanitizeSerialize(lineEnd?: string): (key: unknown, val: unknown) => unknown {\n//   const cache = new Set();\n//   return function (this: unknown, key: unknown, value: unknown) {\n//     if (typeof value === \"object\" && value !== null) {\n//       // Duplicate reference found, discard key\n//       if (cache.has(value)) return \"...\";\n//       cache.add(value);\n//     }\n//     return lineEnd ? value + lineEnd : value;\n//   };\n// }\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nexport function asyncLogValue(val: () => Promise<Serialized>): Promise<LogValue> {\n  // return Promise.resolve(logValue(val));\n  throw new Error(\"Not implemented\");\n}\n\nexport type LogValueArg = LogValue | Serialized | Serialized[] | FnSerialized | undefined | null;\n\nexport interface LogValueState {\n  readonly state?: Set<unknown>;\n  readonly ignoreAttr: Option<RegExp>;\n}\n\nexport function logValue(val: LogValueArg, ctx: LogValueState): LogValue {\n  return logValueInternal(val, {\n    ...ctx,\n    state: ctx.state || new Set<unknown>([Math.random()]),\n  });\n}\n\ntype LogValueStateInternal = LogValueState & { readonly state: Set<unknown> };\n\nfunction logValueInternal(val: LogValueArg, ctx: LogValueStateInternal): LogValue {\n  ctx = {\n    ...ctx,\n    state: ctx.state || new Set<unknown>([Math.random()]),\n  } satisfies LogValueStateInternal;\n  switch (typeof val) {\n    case \"function\":\n      return new LogValue(val);\n    case \"string\": {\n      try {\n        const ret = JSON.parse(val) as LogValueArg;\n        if (typeof ret === \"object\" && ret !== null) {\n          return logValueInternal(ret, ctx);\n        }\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      } catch (e) {\n        try {\n          const url = new URL(val);\n          return new LogValue(() => url.toString());\n          // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        } catch (e) {\n          // ignore\n        }\n      }\n      if (val.match(/[\\n\\r]/)) {\n        const lines = val.split(/[\\n\\r]+/).map((v) => v.trim());\n        return new LogValue(() => lines);\n      }\n      return new LogValue(() => val.toString());\n    }\n    case \"number\":\n      return new LogValue(() => val);\n    case \"boolean\":\n      return new LogValue(() => val);\n    case \"object\": {\n      if (val === null) {\n        return new LogValue(() => \"null\");\n      }\n      if (ArrayBuffer.isView(val)) {\n        try {\n          // should be injected\n          const decoder = new TextDecoder();\n          const asStr = decoder.decode(val);\n          const obj = JSON.parse(asStr) as LogValueArg;\n          return logValueInternal(obj, ctx);\n          // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        } catch (e) {\n          return logValueInternal(bin2string(val, 512), ctx);\n        }\n      }\n      if (Array.isArray(val)) {\n        return new LogValue(() =>\n          (val as Serialized[]).map((v) => logValue(v, { ...ctx, state: undefined }).value() as Serialized),\n        );\n      }\n      // if (val instanceof Response) {\n      //   // my = my.clone() as unknown as LogValue | Serialized[] | null\n      //   // const rval = my as unknown as Partial<Response>;\n      //   // delete rval.clone\n      //   // delete rval.blob\n      // }\n      if (val instanceof Headers) {\n        return new LogValue(() => Object.fromEntries(val.entries()) as unknown as Serialized);\n      }\n      if (val instanceof ReadableStream) {\n        return new LogValue(() => \">Stream<\");\n      }\n      if (val instanceof Promise) {\n        return new LogValue(() => \">Promise<\");\n      }\n\n      // Duplicate reference found, discard key\n      if (ctx.state?.has(val)) {\n        return new LogValue(() => \"...\");\n      }\n      ctx.state?.add(val);\n      if (typeof val.toJSON === \"function\") {\n        return new LogValue(() => val.toJSON());\n      }\n\n      const res: Record<string, LogValue> = {};\n      const typedVal = val as unknown as Record<string, LogValueArg>;\n      for (const key in typedVal) {\n        if (ctx.ignoreAttr.IsSome() && ctx.ignoreAttr.unwrap().test(key)) {\n          continue;\n        }\n        const element = typedVal[key];\n        if (element instanceof LogValue) {\n          res[key] = element;\n        } else {\n          if (typeof element !== \"function\") {\n            res[key] = logValueInternal(element, ctx);\n          }\n        }\n      }\n      // ugly as hell cast but how declare a self-referencing type?\n      return new LogValue(() => res as unknown as Serialized);\n    }\n    default:\n      if (!val) {\n        return new LogValue(() => \"--Falsy--\");\n      }\n      throw new Error(`Invalid type:${typeof val}`);\n  }\n}\n\nexport interface Sized {\n  size: number;\n}\nexport interface Lengthed {\n  length: number;\n}\nexport type SizeOrLength = Sized | Lengthed;\n\nexport interface LogFormatter {\n  format(attr: LogSerializable): Uint8Array;\n}\n\nexport interface LevelHandler {\n  enableLevel(level: Level, ...modules: string[]): void;\n  disableLevel(level: Level, ...modules: string[]): void;\n  setExposeStack(enable?: boolean): void;\n  setIgnoreAttr(re?: RegExp): void;\n  ignoreAttr: Option<RegExp>;\n  isStackExposed: boolean;\n  setDebug(...modules: (string | string[])[]): void;\n  isEnabled(ilevel: unknown, module: unknown): boolean;\n}\n\nexport type HttpType = Response | Result<Response> | Request | Result<Request>;\n\nexport interface LoggerInterface<R> {\n  readonly levelHandler: LevelHandler;\n  TxtEnDe(): TxtEnDecoder;\n  Module(key: string): R;\n  // if modules is empty, set for all Levels\n  EnableLevel(level: Level, ...modules: string[]): R;\n  DisableLevel(level: Level, ...modules: string[]): R;\n\n  Attributes(): Record<string, unknown>;\n\n  SetDebug(...modules: (string | string[])[]): R;\n  // default is /^_/\n  SetIgnoreAttribute(re?: RegExp): R;\n  SetExposeStack(enable?: boolean): R;\n  SetFormatter(fmt: LogFormatter): R;\n\n  Ref(key: string, action: { toString: () => string } | FnSerialized): R;\n  Result<T>(key: string, res: Result<T>): R;\n  // default key url\n  Url(url: CoerceURI, key?: string): R;\n  // len\n  Len(value: unknown, key?: string): R;\n\n  Hash(value: unknown, key?: string): R;\n\n  Str<T extends string | Record<string, string>>(key: T, value?: T extends string ? string : undefined): R;\n  Uint64<T extends string | Record<string, number>>(key: T, value?: T extends string ? number : undefined): R;\n  Int<T extends string | Record<string, number>>(key: T, value?: T extends string ? number : undefined): R;\n  Bool<T extends string | Record<string, unknown>>(key: T, value?: T extends string ? unknown : undefined): R;\n  Any<T extends string | Record<string, unknown>>(key: T, value?: T extends string ? unknown : undefined): R;\n\n  // first string is the key\n  // first response is Response\n  // first request is Request\n  Http(...mix: (HttpType | string)[]): R;\n  Pair(x: Record<string, unknown>): R;\n\n  Error(): R;\n  Warn(): R;\n  Debug(): R;\n  Log(): R;\n  WithLevel(level: Level): R;\n\n  Err<T>(err: T | Result<T> | Error): R; // could be Error, or something which coerces to string\n  Info(): R;\n  Timestamp(): R;\n  Dur(key: string, nsec: number): R;\n}\n\nexport function IsLogger(obj: unknown): obj is Logger {\n  return (\n    typeof obj === \"object\" &&\n    [\n      \"Module\",\n      \"EnableLevel\",\n      \"DisableLevel\",\n      \"SetDebug\",\n      \"Str\",\n      \"Error\",\n      \"Warn\",\n      \"Debug\",\n      \"Log\",\n      \"WithLevel\",\n      \"Err\",\n      \"Info\",\n      \"Timestamp\",\n      \"Any\",\n      \"Dur\",\n      \"Uint64\",\n    ]\n      .map((fn) => typeof (obj as Record<string, unknown>)[fn] === \"function\")\n      .reduce((a, b) => a && b, true)\n  );\n}\n\nexport interface WithLogger extends LoggerInterface<WithLogger> {\n  Logger(): Logger;\n}\n\nexport interface AsError {\n  AsError(): Error;\n  ResultError<T>(): Result<T>;\n}\n\nexport interface Logger extends LoggerInterface<Logger> {\n  With(): WithLogger;\n\n  Msg(...args: string[]): AsError;\n  Flush(): Promise<void>;\n}\n","export abstract class Option<T> {\n  static Some<T>(t: T): Option<T> {\n    return new Some(t);\n  }\n\n  static None<T>(): Option<T> {\n    return new None();\n  }\n\n  static Is<T>(t: unknown): t is Option<T> {\n    return t instanceof Option;\n  }\n\n  static From<T>(t?: T): Option<T> {\n    if (!t) {\n      return new None();\n    }\n    return new Some(t);\n  }\n\n  IsNone(): boolean {\n    return this.is_none();\n  }\n\n  IsSome(): boolean {\n    return this.is_some();\n  }\n  Unwrap(): T {\n    return this.unwrap();\n  }\n\n  abstract is_none(): boolean;\n  abstract is_some(): boolean;\n  abstract unwrap(): T;\n}\n\nexport class Some<T> extends Option<T> {\n  private _t: T;\n  constructor(_t: T) {\n    super();\n    this._t = _t;\n  }\n\n  is_none(): boolean {\n    return false;\n  }\n  is_some(): boolean {\n    return true;\n  }\n  unwrap(): T {\n    return this._t;\n  }\n}\n\nexport class None<T> extends Option<T> {\n  is_none(): boolean {\n    return true;\n  }\n  is_some(): boolean {\n    return false;\n  }\n  unwrap(): T {\n    throw new Error(\"None.unwrap\");\n  }\n}\n\nexport type WithoutOption<T> = T extends Option<infer U> ? U : T;\n","import { LevelHandler, Level } from \"./logger.js\";\nimport { Option } from \"./option.js\";\n\nexport class LevelHandlerImpl implements LevelHandler {\n  readonly _globalLevels: Set<Level> = new Set<Level>([Level.INFO, Level.ERROR, Level.WARN]);\n  readonly _modules: Map<string, Set<Level>> = new Map<string, Set<Level>>();\n\n  ignoreAttr: Option<RegExp> = Option.Some(/^_/);\n  isStackExposed = false;\n  enableLevel(level: Level, ...modules: string[]): void {\n    if (modules.length == 0) {\n      this._globalLevels.add(level);\n      return;\n    }\n    this.forModules(\n      level,\n      (p) => {\n        this._modules.set(p, new Set([...this._globalLevels, level]));\n      },\n      ...modules,\n    );\n  }\n  disableLevel(level: Level, ...modules: string[]): void {\n    if (modules.length == 0) {\n      this._globalLevels.delete(level);\n      return;\n    }\n    this.forModules(\n      level,\n      (p) => {\n        this._modules.delete(p);\n      },\n      ...modules,\n    );\n  }\n\n  setExposeStack(enable?: boolean): void {\n    this.isStackExposed = !!enable;\n  }\n\n  setIgnoreAttr(re?: RegExp): void {\n    this.ignoreAttr = Option.From(re);\n  }\n\n  forModules(level: Level, fnAction: (p: string) => void, ...modules: (string | string[])[]): void {\n    for (const m of modules.flat()) {\n      if (typeof m !== \"string\") {\n        continue;\n      }\n      const parts = m\n        .split(\",\")\n        .map((s) => s.trim())\n        .filter((s) => s.length);\n      for (const p of parts) {\n        fnAction(p);\n      }\n    }\n  }\n  setDebug(...modules: (string | string[])[]): void {\n    this.forModules(\n      Level.DEBUG,\n      (p) => {\n        this._modules.set(p, new Set([...this._globalLevels, Level.DEBUG]));\n      },\n      ...modules,\n    );\n  }\n  isEnabled(ilevel: unknown, module: unknown): boolean {\n    const level = ilevel as Level; // what if it's not a level?\n    if (typeof module === \"string\") {\n      const levels = this._modules.get(module);\n      if (levels && levels.has(level)) {\n        return true;\n      }\n    }\n    const wlevel = this._modules.get(\"*\");\n    if (wlevel && typeof level === \"string\") {\n      if (wlevel.has(level)) {\n        return true;\n      }\n    }\n    if (typeof level !== \"string\") {\n      // this is a plain log\n      return true;\n    }\n    return this._globalLevels.has(level);\n  }\n}\n\nconst levelSingleton = new LevelHandlerImpl();\n\nexport function LevelHandlerSingleton(): LevelHandler {\n  return levelSingleton;\n}\n","// import { v4 } from \"uuid\";\nimport YAML from \"yaml\";\nimport {\n  AsError,\n  FnSerialized,\n  LogSerializable,\n  Level,\n  Logger,\n  logValue,\n  Serialized,\n  WithLogger,\n  // sanitizeSerialize,\n  Sized,\n  Lengthed,\n  LogValue,\n  LevelHandler,\n  LogFormatter,\n  LogValueArg,\n  HttpType,\n  LogValueState,\n} from \"./logger.js\";\nimport { WebSysAbstraction } from \"./web/web-sys-abstraction.js\";\nimport { SysAbstraction } from \"./sys-abstraction.js\";\nimport { Result } from \"./result.js\";\nimport { CoerceURI, URI } from \"./uri.js\";\nimport { runtimeFn } from \"./runtime.js\";\nimport { ConsoleWriterStream } from \"./utils/console-write-stream.js\";\nimport { LogWriterStream } from \"./log-writer-impl.js\";\nimport { TxtEnDecoder, TxtEnDecoderSingleton } from \"./txt-en-decoder.js\";\nimport { LevelHandlerSingleton } from \"./log-level-impl.js\";\n\nfunction getLen(value: unknown, lvs: LogValueState): LogValue {\n  if (Array.isArray(value)) {\n    return logValue(() => value.length, lvs);\n  } else if (typeof value === \"string\") {\n    return logValue(() => value.length, lvs);\n  } else if (typeof value === \"object\" && value !== null) {\n    if (typeof (value as Sized).size === \"number\") {\n      return logValue(() => (value as Sized).size, lvs);\n    } else if (typeof (value as Lengthed).length === \"number\") {\n      return logValue(() => (value as Lengthed).length, lvs);\n    }\n    return logValue(() => Object.keys(value).length, lvs);\n  }\n  return logValue(() => -1, lvs);\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nfunction hash(value: unknown): string {\n  // const hasher = createHash(\"sha256\");\n  // hasher.update(JSON.stringify(value, removeSelfRef()));\n  // return hasher.digest(\"hex\");\n  return \"not implemented\";\n}\n\nfunction toLogValue(lop: LogValue | Promise<LogValue>): LogValue | undefined {\n  if (lop && typeof (lop as Promise<LogValue>).then === \"function\") {\n    throw new Error(\"async logValue Not implemented\");\n  }\n  return lop as LogValue;\n}\n\nexport class JSONFormatter implements LogFormatter {\n  private readonly _txtEnDe: TxtEnDecoder;\n  private readonly _space?: number;\n  constructor(txtEnde: TxtEnDecoder, space?: number) {\n    this._txtEnDe = txtEnde;\n    this._space = space;\n  }\n  format(attr: LogSerializable): Uint8Array {\n    let ret: string;\n    try {\n      ret = JSON.stringify(attr, null, this._space);\n    } catch (e) {\n      ret = JSON.stringify({ internal: { message: (e as Error).message, stack: (e as Error).stack } });\n    }\n    return this._txtEnDe.encode(ret + \"\\n\");\n  }\n}\n\nexport class YAMLFormatter implements LogFormatter {\n  private readonly _txtEnDe: TxtEnDecoder;\n  private readonly _space?: number;\n  constructor(txtEnde: TxtEnDecoder, space?: number) {\n    this._txtEnDe = txtEnde;\n    this._space = space;\n  }\n  format(attr: LogSerializable): Uint8Array {\n    return this._txtEnDe.encode(\"---\\n\" + YAML.stringify(attr, null, this._space) + \"\\n\");\n  }\n}\n\nexport interface LoggerImplParams {\n  readonly out?: WritableStream<Uint8Array>;\n  readonly logWriter?: LogWriterStream;\n  readonly sys?: SysAbstraction;\n  readonly withAttributes?: LogSerializable;\n  readonly levelHandler?: LevelHandler;\n  readonly txtEnDe?: TxtEnDecoder;\n  readonly formatter?: LogFormatter;\n}\n\nfunction toLogValueCtx(lvh: LevelHandler): LogValueState {\n  return {\n    ignoreAttr: lvh.ignoreAttr,\n  };\n}\n\nexport class LoggerImpl implements Logger {\n  readonly _sys: SysAbstraction;\n  readonly _attributes: LogSerializable = {};\n  readonly _withAttributes: LogSerializable;\n  readonly _logWriter: LogWriterStream;\n  readonly levelHandler: LevelHandler;\n  readonly _txtEnDe: TxtEnDecoder;\n  _formatter: LogFormatter;\n  // readonly _id: string = \"logger-\" + Math.random().toString(36)\n\n  constructor(params?: LoggerImplParams) {\n    if (!params) {\n      params = {};\n    }\n    if (!params.sys) {\n      this._sys = WebSysAbstraction();\n    } else {\n      this._sys = params.sys;\n    }\n    if (!params.txtEnDe) {\n      this._txtEnDe = TxtEnDecoderSingleton();\n    } else {\n      this._txtEnDe = params.txtEnDe;\n    }\n    if (!params.formatter) {\n      this._formatter = new JSONFormatter(this._txtEnDe);\n    } else {\n      this._formatter = params.formatter;\n    }\n\n    if (params.logWriter) {\n      this._logWriter = params.logWriter;\n    } else {\n      if (!params.out) {\n        const rt = runtimeFn();\n        let stream: WritableStream<Uint8Array>;\n        if (rt.isBrowser) {\n          stream = new ConsoleWriterStream();\n        } else {\n          if (rt.isNodeIsh || rt.isReactNative || rt.isDeno || rt.isCFWorker) {\n            stream = this._sys.Stdout();\n          } else {\n            throw new Error(\"No output defined for runtime\");\n          }\n        }\n        this._logWriter = new LogWriterStream(stream);\n      } else {\n        this._logWriter = new LogWriterStream(params.out);\n      }\n    }\n    if (!params.withAttributes) {\n      this._withAttributes = {};\n    } else {\n      this._withAttributes = { ...params.withAttributes };\n    }\n    this._attributes = { ...this._withAttributes };\n    if (params.levelHandler) {\n      this.levelHandler = params.levelHandler;\n    } else {\n      this.levelHandler = LevelHandlerSingleton();\n    }\n    // console.log(\"LoggerImpl\", this._id, this._attributes, this._withAttributes)\n  }\n\n  TxtEnDe(): TxtEnDecoder {\n    return this._txtEnDe;\n  }\n\n  Attributes(): Record<string, unknown> {\n    return JSON.parse(JSON.stringify(this._attributes, null)) as Record<string, unknown>;\n    // return Array.from(Object.entries(this._attributes)).reduce(\n    //   (acc, [key, value]) => {\n    //     if (value instanceof LogValue) {\n    //       acc[key] = value.value();\n    //     }\n    //     return acc;\n    //   },\n    //   {} as Record<string, unknown>,\n    // );\n  }\n\n  SetExposeStack(enable?: boolean): Logger {\n    this.levelHandler.setExposeStack(enable);\n    return this;\n  }\n\n  EnableLevel(level: Level, ...modules: string[]): Logger {\n    this.levelHandler.enableLevel(level, ...modules);\n    return this;\n  }\n  DisableLevel(level: Level, ...modules: string[]): Logger {\n    this.levelHandler.disableLevel(level, ...modules);\n    return this;\n  }\n\n  Module(key: string): Logger {\n    this._attributes[\"module\"] = logValue(key, toLogValueCtx(this.levelHandler));\n    this._withAttributes[\"module\"] = logValue(key, toLogValueCtx(this.levelHandler));\n    return this;\n  }\n  // if the string is \"*\" it will enable for all modules\n  SetDebug(...modules: (string | string[])[]): Logger {\n    this.levelHandler.setDebug(...modules);\n    return this;\n  }\n\n  SetIgnoreAttribute(re?: RegExp): Logger {\n    this.levelHandler.setIgnoreAttr(re);\n    return this;\n  }\n\n  SetFormatter(formatter: LogFormatter): Logger {\n    this._formatter = formatter;\n    return this;\n  }\n\n  Timestamp(): Logger {\n    this._attributes[\"ts\"] = logValue(() => this._sys.Time().Now().toISOString(), toLogValueCtx(this.levelHandler));\n    return this;\n  }\n  Warn(): Logger {\n    this._attributes[\"level\"] = logValue(Level.WARN, toLogValueCtx(this.levelHandler));\n    return this;\n  }\n  Log(): Logger {\n    return this;\n  }\n  Debug(): Logger {\n    this._attributes[\"level\"] = logValue(Level.DEBUG, toLogValueCtx(this.levelHandler));\n    return this;\n  }\n  Error(): Logger {\n    this._attributes[\"level\"] = logValue(Level.ERROR, toLogValueCtx(this.levelHandler));\n    return this;\n  }\n  Info(): Logger {\n    this._attributes[\"level\"] = logValue(Level.INFO, toLogValueCtx(this.levelHandler));\n    return this;\n  }\n  Err<T>(err: T | Result<T> | Error): Logger {\n    let key = \"error\";\n    if (Result.Is(err)) {\n      if (err.isOk()) {\n        key = \"noerror\";\n        err = err.Ok();\n      } else {\n        err = err.Err();\n      }\n    }\n    if (err instanceof Error) {\n      if (err.cause) {\n        this.coerceKey(key, {\n          message: err.message,\n          cause: err.cause,\n        });\n      } else {\n        this._attributes[key] = logValue(err.message, toLogValueCtx(this.levelHandler));\n      }\n      if (this.levelHandler.isStackExposed) {\n        this._attributes[\"stack\"] = logValue(\n          err.stack?.split(/[\\r\\n]+/).map((s) => s.trim()),\n          toLogValueCtx(this.levelHandler),\n        );\n      }\n    } else {\n      this.Any(key, err as LogSerializable);\n    }\n    return this;\n  }\n  WithLevel(l: Level): Logger {\n    this._attributes[\"level\"] = logValue(l, toLogValueCtx(this.levelHandler));\n    return this;\n  }\n\n  Ref(key: string, action: { toString: () => string } | FnSerialized): Logger {\n    if (typeof action === \"function\") {\n      this._attributes[key] = logValue(action as FnSerialized, toLogValueCtx(this.levelHandler));\n    } else if (typeof action.toString === \"function\") {\n      this._attributes[key] = logValue(() => action.toString(), toLogValueCtx(this.levelHandler));\n    } else {\n      this._attributes[key] = logValue(\"INVALID REF\", toLogValueCtx(this.levelHandler));\n    }\n    return this;\n  }\n  Bool(key: string | Record<string, unknown>, value: unknown): Logger {\n    this.coerceKey(key, !!value);\n    // this._attributes[key] = logValue(!!value);\n    return this;\n  }\n\n  Http(...mix: (HttpType | string)[]): Logger {\n    const key: string | undefined = mix.find((x) => typeof x === \"string\");\n    mix = mix.filter((x) => typeof x !== \"string\");\n    const resErrors = mix.filter((x) => Result.Is(x) && x.isErr()) as Result<unknown, Error>[];\n    if (resErrors.length) {\n      this.Err(resErrors.map((x) => x.Err().message).join(\"\\n\"));\n      return this;\n    }\n    const req = mix\n      .map((reqOrResult) => (Result.Is(reqOrResult) ? reqOrResult.Ok() : reqOrResult))\n      .find((req) => typeof (req as Response).status !== \"number\") as Request | undefined;\n    const res = mix\n      .map((resOrResult) => (Result.Is(resOrResult) ? resOrResult.Ok() : resOrResult))\n      .find((res) => typeof (res as Response).status === \"number\") as Response | undefined;\n    let reqAndOrres: { res: Response; req: Request } | Response | Request | undefined;\n    if (res && req) {\n      reqAndOrres = { res, req };\n    } else if (!res && !req) {\n      reqAndOrres = undefined;\n    } else if (res) {\n      reqAndOrres = res;\n    } else if (req) {\n      reqAndOrres = req;\n    }\n    if (reqAndOrres) {\n      this.Any(key || \"Http\", reqAndOrres as unknown as LogSerializable);\n    }\n    return this;\n  }\n  Pair(x: Record<string, unknown>): Logger {\n    for (const key of Object.keys(x)) {\n      const value = x[key];\n      if (value instanceof LogValue) {\n        this._attributes[key] = value;\n        continue;\n      }\n      if (Result.Is(value)) {\n        this.Result(key, value);\n        continue;\n      }\n      this.Any(key, value as LogSerializable);\n    }\n    return this;\n  }\n\n  Result<T>(key: string, res: Result<T, Error>): Logger {\n    if (res.isOk()) {\n      this._attributes[key] = logValue(res.Ok() as Serialized, toLogValueCtx(this.levelHandler));\n    } else {\n      this.Err(res.Err());\n    }\n    return this;\n  }\n\n  Len(value: unknown, key = \"len\"): Logger {\n    this._attributes[key] = getLen(value, toLogValueCtx(this.levelHandler));\n    return this;\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  Hash(value: unknown, key = \"hash\"): Logger {\n    throw new Error(\"Not implemented\");\n    // this._attributes[key] = asyncLogValue(\n    //   async () => `${getLen(value, toLogValueCtx(this.levelHandler)).value()}:${await hash(value)}`,\n    // );\n    // return this;\n  }\n\n  Url(url: CoerceURI, key = \"url\"): Logger {\n    this.Ref(key, () => URI.from(url).toString());\n    return this;\n  }\n\n  private coerceKey(key: string | Record<string, unknown>, value?: unknown): void {\n    if (typeof key === \"string\") {\n      this._attributes[key] = logValue(value as LogValueArg, toLogValueCtx(this.levelHandler));\n    } else {\n      this.Pair(key);\n    }\n  }\n\n  Str(key: string | Record<string, string>, value?: string): Logger {\n    this.coerceKey(key, value);\n    return this;\n  }\n\n  Any(key: string | Record<string, unknown>, value?: unknown): Logger {\n    this.coerceKey(key, value);\n    //this._attributes[coerceKey(key)] = logValue(value as LogValueArg);\n    return this;\n  }\n  Dur(key: string, nsec: number): Logger {\n    this._attributes[key] = logValue(`${nsec}ms`, toLogValueCtx(this.levelHandler));\n    // new Intl.DurationFormat(\"en\", { style: \"narrow\" }).format(nsec);\n    return this;\n  }\n  Uint64(key: string | Record<string, number>, value?: number): Logger {\n    this.coerceKey(key, value);\n    //this._attributes[coerceKey(key)] = logValue(value);\n    return this;\n  }\n  Int(key: string | Record<string, number>, value?: number): Logger {\n    return this.Uint64(key, value);\n  }\n\n  async Flush(): Promise<void> {\n    return new Promise((resolve) => {\n      this._logWriter._flush(undefined, resolve);\n    });\n  }\n\n  With(): WithLogger {\n    // console.log(\"WithLoggerBuilder.With\", this._id, this._attributes, this._withAttributes);\n    return new WithLoggerBuilder(\n      new LoggerImpl({\n        logWriter: this._logWriter,\n        sys: this._sys,\n        levelHandler: this.levelHandler,\n        formatter: this._formatter,\n        withAttributes: {\n          module: this._attributes[\"module\"],\n          ...this._withAttributes,\n        },\n      }),\n    );\n  }\n\n  _resetAttributes(fn: () => () => Uint8Array): () => Uint8Array {\n    const ret = fn();\n    Object.keys(this._attributes).forEach((key) => {\n      // eslint-disable-next-line @typescript-eslint/no-dynamic-delete\n      delete this._attributes[key];\n    });\n    Object.assign(this._attributes, this._withAttributes);\n    return ret;\n  }\n\n  Msg(...args: string[]): AsError {\n    const fnError = this._resetAttributes(() => {\n      const doWrite = this.levelHandler.isEnabled(\n        toLogValue(this._attributes[\"level\"])?.value(),\n        toLogValue(this._attributes[\"module\"])?.value(),\n      );\n      this._attributes[\"msg\"] = logValue(args.join(\" \"), toLogValueCtx(this.levelHandler));\n      const msg = this._attributes[\"msg\"].value();\n      if (typeof msg === \"string\" && !msg.trim().length) {\n        delete this._attributes[\"msg\"];\n      }\n      let fnRet = (): Uint8Array => this._formatter.format({ ...this._attributes });\n      if (doWrite) {\n        const encoded = fnRet();\n        this._logWriter.write(encoded);\n        fnRet = (): Uint8Array => encoded;\n      }\n      return fnRet;\n    });\n    const asError = (): Error => new Error(this._txtEnDe.decode(fnError()));\n    return {\n      ResultError: () => Result.Err(asError()),\n      AsError: asError,\n    };\n  }\n}\n\nclass WithLoggerBuilder implements WithLogger {\n  readonly _li: LoggerImpl;\n  readonly levelHandler: LevelHandler;\n  constructor(li: LoggerImpl) {\n    this._li = li;\n    this.levelHandler = li.levelHandler;\n  }\n\n  TxtEnDe(): TxtEnDecoder {\n    return this._li.TxtEnDe();\n  }\n\n  Logger(): Logger {\n    Object.assign(this._li._withAttributes, this._li._attributes);\n    return this._li;\n  }\n\n  Attributes(): Record<string, unknown> {\n    return { ...this._li._attributes };\n  }\n\n  SetExposeStack(enable?: boolean): WithLogger {\n    this._li.levelHandler.setExposeStack(enable);\n    return this;\n  }\n\n  SetIgnoreAttribute(re?: RegExp): WithLogger {\n    this._li.levelHandler.setIgnoreAttr(re);\n    return this;\n  }\n\n  SetFormatter(fmt: LogFormatter): WithLogger {\n    this._li.SetFormatter(fmt);\n    return this;\n  }\n\n  EnableLevel(level: Level, ...modules: string[]): WithLogger {\n    this._li.levelHandler.enableLevel(level, ...modules);\n    return this;\n  }\n  DisableLevel(level: Level, ...modules: string[]): WithLogger {\n    this._li.levelHandler.enableLevel(level, ...modules);\n    return this;\n  }\n\n  Module(key: string): WithLogger {\n    this._li.Module(key);\n    return this;\n  }\n  SetDebug(...modules: (string | string[])[]): WithLogger {\n    this._li.SetDebug(...modules);\n    return this;\n  }\n\n  Http(...mix: (HttpType | string)[]): WithLogger {\n    this._li.Http(...mix);\n    return this;\n  }\n  Pair(x: Record<string, unknown>): WithLogger {\n    this._li.Pair(x);\n    return this;\n  }\n\n  Str(key: string | Record<string, string>, value?: string): WithLogger {\n    this._li.Str(key, value);\n    return this;\n  }\n\n  Len(value: unknown, key?: string): WithLogger {\n    this._li.Len(value, key);\n    return this;\n  }\n\n  Hash(value: unknown, key?: string): WithLogger {\n    this._li.Hash(value, key);\n    return this;\n  }\n\n  Ref(key: string, action: Serialized | FnSerialized): WithLogger {\n    this._li.Ref(key, action);\n    return this;\n  }\n  Bool(key: string | Record<string, unknown>, value?: unknown): WithLogger {\n    this._li.Bool(key, value);\n    return this;\n  }\n  Result<T>(key: string, res: Result<T, Error>): WithLogger {\n    this._li.Result(key, res);\n    return this;\n  }\n  Url(url: CoerceURI, key?: string): WithLogger {\n    this._li.Url(url, key);\n    return this;\n  }\n  Int(key: string | Record<string, number>, value?: number): WithLogger {\n    this._li.Int(key, value);\n    return this;\n  }\n\n  Log(): WithLogger {\n    this._li.Log();\n    return this;\n  }\n\n  WithLevel(level: Level): WithLogger {\n    this._li.WithLevel(level);\n    return this;\n  }\n\n  Error(): WithLogger {\n    this._li.Error();\n    return this;\n  }\n  Warn(): WithLogger {\n    this._li.Error();\n    return this;\n  }\n  Debug(): WithLogger {\n    this._li.Debug();\n    return this;\n  }\n  Err(err: unknown): WithLogger {\n    this._li.Err(err);\n    return this;\n  }\n  Info(): WithLogger {\n    this._li.Info();\n    return this;\n  }\n  Timestamp(): WithLogger {\n    this._li.Timestamp();\n    return this;\n  }\n  Any<T>(key: string | Record<string, unknown>, value?: T | LogSerializable): WithLogger {\n    this._li.Any(key, value);\n    return this;\n  }\n  Dur(key: string, nsec: number): WithLogger {\n    this._li.Dur(key, nsec);\n    return this;\n  }\n  Uint64(key: string | Record<string, number>, value?: number): WithLogger {\n    this._li.Uint64(key, value);\n    return this;\n  }\n}\n","export const PartType = {\n  Slash: 0x1,\n  Root: 0x3,\n  Up: 0x4 /* /../ */,\n  Noop: 0x8 /* ./ */,\n  // RootUp = 0x8 /* ../ */,\n};\n\nexport type PartType = (typeof PartType)[keyof typeof PartType];\n\nexport type PathItem = string | PartType;\n\nexport class Path {\n  readonly parts: PathItem[];\n  constructor(parts: PathItem[] = []) {\n    this.parts = parts;\n  }\n\n  toString(): string {\n    return this.parts\n      .map((part) => {\n        if (typeof part === \"string\") {\n          return part;\n        } else {\n          switch (part) {\n            case PartType.Slash:\n            case PartType.Root:\n              return \"/\";\n            case PartType.Up:\n              return \"..\";\n            default:\n              return part;\n          }\n        }\n      })\n      .join(\"\");\n  }\n\n  add(part: PathItem): void {\n    if (this.parts.includes(PartType.Root) && part === PartType.Root) {\n      throw new Error(\"Cannot add absolute part to absolute path\");\n    }\n    const last = this.parts[this.parts.length - 1] as PartType;\n    if (last & PartType.Slash && part === PartType.Slash) {\n      return;\n    }\n    switch (part) {\n      case \".\":\n        this.parts.push(PartType.Noop);\n        return;\n      case \"..\":\n        part = PartType.Up;\n    }\n\n    // if (part === PartType.Up && last === PartType.Slash) {\n    //     this.parts[this.parts.length - 1] = PartType.Up\n    //     return\n    // }\n    if (last === PartType.Noop && part === PartType.Slash) {\n      if (last === PartType.Noop) {\n        this.parts.pop();\n      }\n      return;\n    }\n    this.parts.push(part);\n  }\n}\n\nexport function splitPath(path: string): Path {\n  const p = new Path();\n  if (path === \"\") {\n    return p;\n  }\n  for (let count = 0; path.length; count++) {\n    // const ipath = path\n    if (path.match(/^\\/+/)) {\n      if (count === 0) {\n        p.add(PartType.Root);\n      } else {\n        p.add(PartType.Slash);\n      }\n      path = path.replace(/^\\/+/, \"\");\n    } else {\n      const part = path.replace(/\\/.*$/, \"\");\n      p.add(part);\n      path = path.replace(/^[^/]+/, \"\");\n    }\n  }\n  return p;\n}\n\nexport function pathJoin(...paths: string[]): string {\n  let prev = \"\";\n  const res: string[] = [];\n  // eslint-disable-next-line @typescript-eslint/prefer-for-of\n  for (let i = 0; i < paths.length; i++) {\n    const path = paths[i];\n    if (path === \"\") {\n      continue;\n    }\n    // i + 1 !== paths.length &&\n    if (!(prev.endsWith(\"/\") || path.startsWith(\"/\"))) {\n      if (prev !== \"\") {\n        res.push(\"/\");\n      }\n      res.push(path);\n    } else {\n      res.push(path);\n    }\n    prev = path;\n  }\n  return res.join(\"\");\n}\n\nexport function relativePath(path: string, relative: string): string {\n  const relativeParts = splitPath(relative);\n  let result: string;\n  if (relativeParts.parts[0] === PartType.Root) {\n    result = relative;\n  } else {\n    result = pathJoin(path, relative);\n  }\n  const unoptPath = splitPath(result);\n  // console.log(\"What\", result, unoptPath.parts)\n  const out: PathItem[] = [];\n  let topUp = false;\n  for (const part of unoptPath.parts) {\n    switch (part) {\n      case PartType.Root:\n        out.push(PartType.Root);\n        break;\n      case PartType.Up:\n        if (out.length && !topUp) {\n          const last = out.length - 1;\n          if (typeof out[last] === \"string\" && (out[last - 1] as PartType) == PartType.Root) {\n            out.pop();\n          } else {\n            out.pop();\n            out.pop();\n          }\n          if (out.length === 0) {\n            topUp = !topUp ? true : topUp;\n            out.push(PartType.Up);\n          }\n        } else {\n          out.push(PartType.Up);\n        }\n        break;\n      case PartType.Slash:\n        if (!((out[out.length - 1] as PartType) & PartType.Slash)) {\n          out.push(PartType.Slash);\n        }\n        break;\n      default:\n        out.push(part);\n        break;\n    }\n  }\n  return new Path(out).toString();\n  // return pathParts\n  //     .filter((part, index) => part !== relativeParts[index])\n  //     .join(\"\")\n}\n","import type { DeepWritable } from \"ts-essentials\";\nimport { exception2Result, Result } from \"./result.js\";\nimport { getParamsResult, KeysParam } from \"./utils/get-params-result.js\";\nimport { relativePath } from \"./utils/relative-path.js\";\nimport { StripCommand, stripper } from \"./utils/stripper.js\";\n// import { param } from \"./types.js\";\n\ntype NullOrUndef = null | undefined;\n\ntype OneKey<K extends string, V = string> = Record<K, V>;\n\n/** @xdeprecated use param from get-params-result */\n// export const key = param;\n\n/*\n  if KeyParam is a Object\n     if the right side is a string, it is the default value\n     if the right side is a !string | REQUIRED, it is required\n*/\n\n// type ReturnType<T extends (...args: KeysParam) => unknown> = T extends (...args: KeysParam) => infer R ? R : unknown;\n\n// function fetchData<T extends (...args: any[]) => Promise<any>>(fn: T): ReturnType<T> {\n//   return fn();\n// }\n// type ReturnObject<T extends KeysParam> = {\n//   [K in keyof T]: string;\n// };\n\nexport interface URIInterface<R extends URIInterface<R>> {\n  // readonly hostname: string;\n  // readonly port: string;\n  // readonly host: string;\n  // readonly protocol: string;\n  // readonly pathname: string;\n  readonly getParams: Iterable<[string, string]>;\n\n  hasParam(key: string): boolean;\n  getParam<T extends string | undefined>(key: string | OneKey<string>, def?: T): T extends string ? string : string | undefined;\n  getParamResult(key: string, msgFn?: (key: string) => string): Result<string>;\n  getParamsResult(...keys: KeysParam): Result<Record<string, string>>;\n  match(other: CoerceURI): MatchResult;\n  clone(): R;\n  asURL(): URL;\n  toString(): string;\n  toJSON(): string;\n  asObj(...strips: StripCommand[]): Partial<HostURIObject | PathURIObject>;\n}\n\nexport interface MatchResult {\n  readonly score: number;\n  readonly protocol: boolean;\n  readonly hostname: boolean;\n  readonly port: boolean;\n  readonly pathname: boolean;\n  readonly pathParts: string[];\n  readonly params: Record<string, string>;\n}\n\nfunction match(iref: CoerceURI, ioth: CoerceURI): MatchResult {\n  const mr: DeepWritable<MatchResult> = {\n    score: 0,\n    protocol: false,\n    hostname: false,\n    port: false,\n    pathname: false,\n    pathParts: [],\n    params: {},\n  };\n  const ref = URI.from(iref);\n  const oth = URI.from(ioth);\n  if (ref.protocol === oth.protocol) {\n    mr.score += 1;\n    mr.protocol = true;\n  }\n  try {\n    const refH = ref.hostname;\n    const refP = ref.port;\n    if (refH === oth.hostname) {\n      mr.score += 1;\n      mr.hostname = true;\n    }\n    if (refP.length && refP === oth.port) {\n      mr.score += 1;\n      mr.port = true;\n    }\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  } catch (e) {\n    // ignore\n  }\n  if (ref.pathname.length && ref.pathname !== \"/\") {\n    const pref = ref.pathname.split(\"/\").filter((p) => p.length);\n    const poth = oth.pathname.split(\"/\").filter((p) => p.length);\n    for (let i = 0; i < pref.length && i < poth.length; i++) {\n      if (poth[i] === pref[i]) {\n        mr.score += 1;\n        mr.pathname = true;\n        mr.pathParts.push(pref[i]);\n      }\n    }\n  }\n  for (const [key, value] of ref.getParams) {\n    if (oth.getParam(key) === value) {\n      mr.score += 1;\n      mr.params[key] = value;\n    }\n  }\n  return mr;\n}\n\nfunction coerceKey(key: string | OneKey<string>, def?: string): { key: string; def?: string } {\n  if (typeof key === \"object\") {\n    const keys = Object.keys(key);\n    if (keys.length !== 1) {\n      throw new Error(`Invalid key: ${JSON.stringify(key)}`);\n    }\n    return { key: keys[0], def: key[keys[0]] };\n  }\n  return { key, def: def };\n}\n\nexport interface URIObject {\n  readonly style: \"host\" | \"path\";\n  readonly protocol: string;\n  readonly pathname: string;\n  readonly searchParams: Record<string, string>;\n}\n\nexport interface PathURIObject extends URIObject {\n  readonly style: \"path\";\n}\n\nexport interface HostURIObject extends URIObject {\n  readonly style: \"host\";\n  readonly hostname: string;\n  readonly port: string;\n}\n\nfunction falsy2undef<T>(value: T | NullOrUndef): T | undefined {\n  return value === undefined || value === null ? undefined : value;\n}\n\nfunction ensureURLWithDefaultProto(url: string | URL, defaultProtocol: string): MutableURL {\n  if (!url) {\n    return new MutableURL(`${defaultProtocol}//`);\n  }\n  if (typeof url === \"string\") {\n    try {\n      return new MutableURL(url);\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    } catch (e) {\n      return new MutableURL(`${defaultProtocol}//${url}`);\n    }\n  } else {\n    return new MutableURL(url.toString());\n  }\n}\n\nexport function isURL(value: unknown): value is URL {\n  return (\n    value instanceof URL ||\n    (!!value &&\n      typeof (value as URL).searchParams === \"object\" &&\n      typeof (value as URL).searchParams.sort === \"function\" &&\n      typeof (value as URL).hash === \"string\")\n  );\n}\n\n// due to that the System URL class is has a strange behavior\n// on different platforms, we need to implement our own URL class\nexport class MutableURL extends URL {\n  private readonly _sysURL: URL;\n  // private readonly _urlStr: string;\n\n  private _protocol: string;\n  private _pathname: string;\n  private _hasHostpart: boolean;\n\n  override readonly hash: string;\n\n  constructor(urlStr: string) {\n    super(\"defect://does.not.exist\");\n    const partedURL = urlStr.split(\":\");\n    this._hasHostpart = hasHostPartProtocols.has(partedURL[0]);\n    let hostPartUrl = [\"http\", ...partedURL.slice(1)].join(\":\");\n    if (!this._hasHostpart) {\n      const pathname = hostPartUrl.replace(/http:\\/\\/[/]*/, \"\").replace(/[#?].*$/, \"\");\n      hostPartUrl = hostPartUrl.replace(/http:\\/\\//, `http://localhost/${pathname}`);\n    }\n    try {\n      this._sysURL = new URL(hostPartUrl);\n    } catch (ie) {\n      const e = ie as Error;\n      e.message = `${e.message} for URL: ${urlStr}`;\n      throw e;\n    }\n    this._protocol = `${partedURL[0]}:`; // this._sysURL.protocol.replace(new RegExp(\"^cement-\"), \"\");\n    if (this._hasHostpart) {\n      this._pathname = this._sysURL.pathname;\n    } else {\n      this._pathname = urlStr.replace(new RegExp(`^${this._protocol}//`), \"\").replace(/[#?].*$/, \"\");\n    }\n    this.hash = this._sysURL.hash;\n  }\n\n  clone(): MutableURL {\n    return new MutableURL(this.toString());\n  }\n\n  override get host(): string {\n    if (!this._hasHostpart) {\n      throw new Error(\n        `you can use hostname only if protocol is ${this.toString()} ${JSON.stringify(Array.from(hasHostPartProtocols.keys()))}`,\n      );\n    }\n    return this._sysURL.host;\n  }\n\n  override get port(): string {\n    if (!this._hasHostpart) {\n      throw new Error(`you can use hostname only if protocol is ${JSON.stringify(Array.from(hasHostPartProtocols.keys()))}`);\n    }\n    return this._sysURL.port;\n  }\n\n  override set port(p: string) {\n    if (!this._hasHostpart) {\n      throw new Error(`you can use port only if protocol is ${JSON.stringify(Array.from(hasHostPartProtocols.keys()))}`);\n    }\n    this._sysURL.port = p;\n  }\n\n  override get hostname(): string {\n    if (!this._hasHostpart) {\n      throw new Error(`you can use hostname only if protocol is ${JSON.stringify(Array.from(hasHostPartProtocols.keys()))}`);\n    }\n    return this._sysURL.hostname;\n  }\n\n  override set hostname(h: string) {\n    if (!this._hasHostpart) {\n      throw new Error(`you can use hostname only if protocol is ${JSON.stringify(Array.from(hasHostPartProtocols.keys()))}`);\n    }\n    this._sysURL.hostname = h;\n  }\n\n  override set pathname(p: string) {\n    this._pathname = p;\n  }\n\n  override get pathname(): string {\n    return this._pathname;\n  }\n\n  override get protocol(): string {\n    return this._protocol;\n  }\n\n  override set protocol(p: string) {\n    if (!p.endsWith(\":\")) {\n      p = `${p}:`;\n    }\n    this._protocol = p;\n  }\n\n  override get searchParams(): URLSearchParams {\n    return this._sysURL.searchParams;\n  }\n\n  override toString(): string {\n    let search = \"\";\n    if (this._sysURL.searchParams.size) {\n      for (const [key, value] of Array.from(this._sysURL.searchParams.entries()).sort((a, b) => a[0].localeCompare(b[0]))) {\n        search += `${!search.length ? \"?\" : \"&\"}${key}=${encodeURIComponent(value)}`;\n      }\n    }\n    let hostpart = \"\";\n    if (this._hasHostpart) {\n      hostpart = this._sysURL.hostname;\n      if (this._sysURL.port) {\n        hostpart += `:${this._sysURL.port}`;\n      }\n      if (!this._pathname.startsWith(\"/\")) {\n        hostpart += \"/\";\n      }\n    }\n    return `${this._protocol}//${hostpart}${this._pathname}${search}`;\n  }\n}\n\nfunction from<T>(fac: (url: MutableURL) => T, strURLUri: CoerceURI | undefined, defaultProtocol: string): T {\n  switch (typeof falsy2undef(strURLUri)) {\n    case \"undefined\":\n      return fac(new MutableURL(`${defaultProtocol}///`));\n    case \"string\":\n      return fac(ensureURLWithDefaultProto(strURLUri as string, defaultProtocol));\n    case \"object\":\n      if (BuildURI.is(strURLUri)) {\n        return fac(new MutableURL(strURLUri._url.toString()));\n      } else if (URI.is(strURLUri)) {\n        return fac(new MutableURL(strURLUri._url.toString()));\n      } else if (isURL(strURLUri)) {\n        return fac(new MutableURL(strURLUri.toString()));\n      }\n      throw new Error(`unknown object type: ${strURLUri}`);\n    default:\n      throw new Error(`Invalid argument: ${typeof strURLUri}`);\n  }\n}\n\nfunction getParamResult(\n  key: string,\n  val: string | undefined,\n  msgFn: (key: string) => string = (key) => {\n    return `missing parameter: ${key}`;\n  },\n): Result<string> {\n  if (val === undefined) {\n    return Result.Err(msgFn(key));\n  }\n  return Result.Ok(val);\n}\n\nexport class BuildURI implements URIInterface<BuildURI> {\n  _url: MutableURL; // pathname needs this\n  private constructor(url: MutableURL) {\n    this._url = url;\n  }\n\n  static is(value: unknown): value is BuildURI {\n    return (\n      value instanceof BuildURI ||\n      (!!value && typeof (value as BuildURI).delParam === \"function\" && typeof (value as BuildURI).setParam === \"function\")\n    );\n  }\n  static from(strURLUri?: CoerceURI, defaultProtocol = \"file:\"): BuildURI {\n    return from((url) => new BuildURI(url), strURLUri, defaultProtocol);\n  }\n\n  match(other: CoerceURI): MatchResult {\n    return match(this.URI(), URI.from(other));\n  }\n\n  port(p: string): BuildURI {\n    this._url.port = p;\n    return this;\n  }\n\n  hostname(h: string): BuildURI {\n    this._url.hostname = h;\n    return this;\n  }\n\n  protocol(p: string): BuildURI {\n    if (!p.endsWith(\":\")) {\n      p = `${p}:`;\n    }\n    this._url.protocol = p;\n    return this;\n  }\n\n  pathname(p: string): BuildURI {\n    this._url.pathname = p;\n    return this;\n  }\n\n  // could pass a relative path or a full URL\n  // if relative path, it will be appended to the current path\n  resolve(p: CoerceURI): BuildURI {\n    if (!p) {\n      return this;\n    }\n    if (typeof p === \"string\") {\n      // relative path\n      if (!p.match(/^[a-zA-Z0-9]+:/)) {\n        if (p.startsWith(\"/\")) {\n          this.pathname(p);\n          return this;\n        }\n        return this.appendRelative(p);\n      }\n    }\n    this._url = new MutableURL(p.toString());\n    return this;\n  }\n\n  appendRelative(p: CoerceURI): BuildURI {\n    const appendUrl = URI.from(p);\n    const pathname = \"./\" + appendUrl.pathname;\n    const basePath = this._url.pathname;\n    /*\n     * cases\n     *  pathname \"\" basePAth \"\" -> \"\"\n     *  pathname \"/\" basePath \"\" -> \"/\"\n     *  pathname \"\" basePath \"/\" -> \"/\"\n     *  pathname \"/\" basePath \"/\" -> \"/\"\n     *  pathname \"ab\" basePath \"\" -> \"/ab\"\n     *  pathname \"ab\" basePath \"/\" -> \"/ab\"\n     *  pathname \"ab\" basePath \"/ab/\" -> \"/ab/ab\"\n     *  pathname \"/ab/\" basePath \"/ab/\" -> \"/ab/ab/\"\n     */\n    this.pathname(relativePath(basePath, pathname));\n    // if (pathname.startsWith(\"/\")) {\n    //   pathname = pathname.replace(/^\\//, \"\");\n    // }\n    // if (basePath.length > 0) {\n    //   basePath = basePath.replace(/\\/$/, \"\");\n    // }\n    // this.pathname(basePath + \"/\" + pathname);\n    for (const [key, value] of appendUrl.getParams) {\n      this.setParam(key, value);\n    }\n    return this;\n  }\n\n  cleanParams(): BuildURI {\n    for (const key of Array.from(this._url.searchParams.keys())) {\n      this._url.searchParams.delete(key);\n    }\n    return this;\n  }\n\n  delParam(key: string): BuildURI {\n    this._url.searchParams.delete(key);\n    return this;\n  }\n\n  defParam(key: string, str: string): BuildURI {\n    if (!this._url.searchParams.has(key)) {\n      this._url.searchParams.set(key, str);\n    }\n    return this;\n  }\n\n  setParam(key: string, str: string): BuildURI {\n    this._url.searchParams.set(key, str);\n    return this;\n  }\n\n  hasParam(key: string): boolean {\n    return this._url.searchParams.has(key);\n  }\n\n  get getParams(): Iterable<[string, string]> {\n    return this._url.searchParams.entries();\n  }\n\n  getParam<T extends string | undefined>(key: string | OneKey<string>, def?: T): T extends string ? string : string | undefined {\n    const { key: k, def: d } = coerceKey(key, def);\n    let val = this._url.searchParams.get(k);\n    if (!falsy2undef(val) && d) {\n      val = d;\n    }\n    return falsy2undef(val) as T extends string ? string : string | undefined;\n  }\n\n  getParamResult(key: string, msgFn?: (key: string) => string): Result<string> {\n    return getParamResult(key, this.getParam(key), msgFn);\n  }\n\n  getParamsResult(...keys: KeysParam): Result<Record<string, string>> {\n    return getParamsResult(keys, this);\n  }\n\n  toString(): string {\n    this._url.searchParams.sort();\n    return this._url.toString();\n  }\n  toJSON(): string {\n    return this.toString();\n  }\n\n  asURL(): URL {\n    return this.URI().asURL();\n  }\n\n  asObj(...strips: StripCommand[]): Partial<HostURIObject | PathURIObject> {\n    return this.URI().asObj(...strips);\n  }\n\n  clone(): BuildURI {\n    return BuildURI.from(this.toString());\n  }\n\n  URI(): URI {\n    return URI.from(this._url);\n  }\n}\n\nexport type CoerceURI = string | URI | MutableURL | URL | BuildURI | NullOrUndef;\n\nexport function isCoerceURI(value: unknown): value is CoerceURI {\n  if (!value) {\n    return false;\n  }\n  if (isURL(value)) {\n    // includes MutableURL\n    return true;\n  }\n  if (URI.is(value)) {\n    return true;\n  }\n  if (BuildURI.is(value)) {\n    return true;\n  }\n  if (typeof value === \"string\") {\n    return true;\n  }\n  return false;\n}\n\nexport const hasHostPartProtocols: Set<string> = new Set<string>([\"http\", \"https\", \"ws\", \"wss\"]);\n\n// non mutable URL Implementation\nexport class URI implements URIInterface<URI> {\n  static protocolHasHostpart(protocol: string): () => void {\n    protocol = protocol.replace(/:$/, \"\");\n    hasHostPartProtocols.add(protocol);\n    return () => {\n      hasHostPartProtocols.delete(protocol);\n    };\n  }\n\n  match(other: CoerceURI): MatchResult {\n    return match(this, other);\n  }\n\n  // if no protocol is provided, default to file:\n  static merge(into: CoerceURI, from: CoerceURI, defaultProtocol = \"file:\"): URI {\n    const intoUrl = BuildURI.from(into, defaultProtocol);\n    const fromUrl = URI.from(from, defaultProtocol);\n\n    intoUrl.protocol(fromUrl.protocol);\n    const fPath = fromUrl.pathname;\n    if (!(fPath.length === 0 || fPath === \"/\" || fPath === \"./\")) {\n      intoUrl.pathname(fromUrl.pathname);\n    }\n    for (const [key, value] of fromUrl.getParams) {\n      intoUrl.setParam(key, value);\n    }\n    return intoUrl.URI();\n  }\n\n  static is(value: unknown): value is URI {\n    return (\n      value instanceof URI ||\n      (!!value &&\n        typeof (value as URI).asURL === \"function\" &&\n        typeof (value as URI).getParam === \"function\" &&\n        typeof (value as URI).hasParam === \"function\")\n    );\n  }\n\n  // if no protocol is provided, default to file:\n  static from(strURLUri?: CoerceURI, defaultProtocol = \"file:\"): URI {\n    return from((url) => new URI(url), strURLUri, defaultProtocol);\n  }\n\n  static fromResult(strURLUri?: CoerceURI, defaultProtocol = \"file:\"): Result<URI> {\n    return exception2Result(() => from((url) => new URI(url), strURLUri, defaultProtocol)) as Result<URI>;\n  }\n\n  readonly _url: MutableURL;\n  private constructor(url: MutableURL) {\n    this._url = url.clone();\n  }\n\n  build(): BuildURI {\n    return BuildURI.from(this._url);\n  }\n\n  get hostname(): string {\n    return this._url.hostname;\n  }\n\n  // get password(): string {\n  //   return this._url.password;\n  // }\n\n  get port(): string {\n    return this._url.port;\n  }\n\n  get host(): string {\n    return this._url.host;\n  }\n\n  // get username(): string {\n  //   return this._url.username;\n  // }\n\n  // get search(): string {\n  //   return this._url.search;\n  // }\n\n  get protocol(): string {\n    return this._url.protocol;\n  }\n\n  get pathname(): string {\n    return this._url.pathname;\n    // return this._url\n    //   .toString()\n    //   .replace(/^.*:\\/\\//, \"\")\n    //   .replace(/\\?.*$/, \"\");\n  }\n\n  // get hash(): string {\n  //   return this._url.hash;\n  // }\n\n  // get host(): string {\n  //   return this._url.host;\n  // }\n\n  get getParams(): Iterable<[string, string]> {\n    return this._url.searchParams.entries();\n  }\n\n  hasParam(key: string): boolean {\n    return this._url.searchParams.has(key);\n  }\n\n  getParam<T extends string | undefined>(key: string | OneKey<string>, def?: T): T extends string ? string : string | undefined {\n    const { key: k, def: d } = coerceKey(key, def);\n    let val = this._url.searchParams.get(k);\n    if (!falsy2undef(val) && d) {\n      val = d;\n    }\n    return falsy2undef(val) as T extends string ? string : string | undefined;\n  }\n\n  getParamResult(key: string, msgFn?: (key: string) => string): Result<string> {\n    return getParamResult(key, this.getParam(key), msgFn);\n  }\n\n  getParamsResult(...keys: KeysParam): Result<Record<string, string>> {\n    return getParamsResult(keys, this);\n  }\n\n  clone(): URI {\n    return new URI(this._url);\n  }\n\n  asURL(): URL {\n    // const url = new URL(this._url.toString());\n    // url.searchParams.sort();\n    return this._url.clone() as unknown as URL;\n  }\n\n  toString(): string {\n    // this._url.searchParams.sort();\n    return this._url.toString();\n  }\n  toJSON(): string {\n    return this.toString();\n  }\n  asObj(...strips: StripCommand[]): Partial<HostURIObject | PathURIObject> {\n    const pathURI: PathURIObject = {\n      style: \"path\",\n      protocol: this.protocol,\n      pathname: this.pathname,\n      searchParams: Object.fromEntries(this.getParams),\n    };\n    if (hasHostPartProtocols.has(this.protocol.replace(/:$/, \"\"))) {\n      return stripper(strips, {\n        ...pathURI,\n        style: \"host\",\n        hostname: this.hostname,\n        port: this.port,\n      }) as Partial<HostURIObject>;\n    }\n    return stripper(strips, pathURI) as Partial<PathURIObject>;\n  }\n}\n","export class LogWriterStream {\n  readonly _out: WritableStream<Uint8Array>;\n  readonly _toFlush: (() => Promise<void>)[] = [];\n\n  constructor(out: WritableStream<Uint8Array>) {\n    this._out = out;\n  }\n\n  write(encoded: Uint8Array): void {\n    const my = async (): Promise<void> => {\n      // const val = Math.random();\n      // console.log(\">>>My:\", encoded)\n      try {\n        const writer = this._out.getWriter();\n        await writer.ready;\n        await writer.write(encoded);\n        writer.releaseLock();\n      } catch (err) {\n        // eslint-disable-next-line no-console\n        console.error(\"Chunk error:\", err);\n      }\n      // console.log(\"<<<My:\", val)\n    };\n    this._toFlush.push(my);\n    this._flush();\n  }\n\n  _flushIsRunning = false;\n  _flushDoneFns: (() => void)[] = [];\n  _flush(toFlush: (() => Promise<void>)[] | undefined = undefined, done?: () => void): void {\n    if (done) {\n      this._flushDoneFns.push(done);\n    }\n\n    if (this._toFlush.length == 0) {\n      // console.log(\"Flush is stopped\", this._toFlush.length)\n      this._flushIsRunning = false;\n      this._flushDoneFns.forEach((fn) => fn());\n      this._flushDoneFns = [];\n      return;\n    }\n\n    if (!toFlush && this._toFlush.length == 1 && !this._flushIsRunning) {\n      this._flushIsRunning = true;\n      // console.log(\"Flush is started\", this._toFlush.length)\n    } else if (!toFlush) {\n      // console.log(\"flush queue check but is running\", this._toFlush.length)\n      return;\n    }\n\n    // console.log(\">>>Msg:\", this._toFlush.length)\n    const my = this._toFlush.shift();\n    my?.()\n      .catch((e) => {\n        // eslint-disable-next-line no-console\n        console.error(\"Flush error:\", e);\n      })\n      .finally(() => {\n        // console.log(\"<<<Msg:\", this._toFlush.length)\n        this._flush(this._toFlush);\n      });\n  }\n}\n","import { LevelHandlerImpl } from \"../log-level-impl.js\";\nimport { Logger } from \"../logger.js\";\nimport { LoggerImpl } from \"../logger-impl.js\";\nimport { SysAbstraction } from \"../sys-abstraction.js\";\nimport { LogCollector } from \"./log-write-stream.js\";\n\nexport interface MockLoggerReturn {\n  readonly logger: Logger;\n  readonly logCollector: LogCollector;\n}\n\nexport function MockLogger(params?: {\n  readonly sys?: SysAbstraction;\n  readonly pass?: WritableStreamDefaultWriter<Uint8Array>;\n  moduleName?: string | string[];\n  readonly disableDebug?: boolean;\n}): MockLoggerReturn {\n  const lc = new LogCollector(params?.pass);\n  let modNames = [\"MockLogger\"];\n  if (typeof params?.moduleName === \"string\") {\n    modNames = [params?.moduleName];\n  } else if (Array.isArray(params?.moduleName)) {\n    modNames = [...params.moduleName, ...modNames];\n  }\n  const logger = new LoggerImpl({\n    out: lc,\n    sys: params?.sys,\n    levelHandler: new LevelHandlerImpl(),\n  })\n    .With()\n    .Module(modNames[0])\n    .Logger();\n  if (!params?.disableDebug) {\n    logger.SetDebug(...modNames);\n  }\n  return {\n    logCollector: lc,\n    logger,\n  };\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;AAIO,IAAM,iBAAN,MAAwE;AAAA,EAG7E,YAAY,WAAyB;AAIrC,SAAS,iBAAoC,IAAI,OAAkB;AACnE,SAAS,SAA6B,KAAK,eAAe,UAAU;AACpE,SAAS,cAA6B;AACtC,SAAS,QAA4B,QAAQ,QAAQ,MAAS;AAN5D,SAAK,aAAa;AAAA,EACpB;AAAA;AAAA,EAQA,MAAM,QAA6B;AACjC,UAAM,IAAI,MAAM,yBAAyB;AAAA,EAC3C;AAAA,EACA,MAAM,QAAuB;AAC3B,UAAM,KAAK;AACX,WAAO,QAAQ,QAAQ,MAAS;AAAA,EAClC;AAAA,EACA,cAAoB;AAAA,EAEpB;AAAA,EACA,MAAM,MAAM,OAAmC;AAC7C,QAAI,OAAO;AACT,WAAK,WAAW,KAAK,KAAK;AAAA,IAC5B;AACA,WAAO,QAAQ,QAAQ,MAAS;AAAA,EAClC;AACF;AAEO,IAAM,eAAN,MAAyD;AAAA,EAO9D,YAAY,MAAgD,SAAwB;AANpF,SAAS,SAAkB;AAG3B,SAAiB,aAA2B,CAAC;AAI3C,SAAK,QAAQ;AACb,SAAK,WAAW,WAAW,sBAAsB;AAAA,EACnD;AAAA;AAAA,EAGA,MAAM,QAAoC;AACxC,UAAM,IAAI,MAAM,yBAAyB;AAAA,EAC3C;AAAA,EAEA,MAAM,QAAuB;AAC3B,QAAI,KAAK,SAAS;AAChB,YAAM,MAAM,MAAM,KAAK,QAAQ,MAAM;AACrC,WAAK,UAAU;AACf,aAAO;AAAA,IACT;AACA,WAAO,QAAQ,QAAQ,MAAS;AAAA,EAClC;AAAA,EAEA,YAAqD;AACnD,QAAI,CAAC,KAAK,SAAS;AACjB,YAAM,QAAmD,CAAC,IAAI,eAAe,KAAK,UAAU,CAAC;AAC7F,UAAI,KAAK,OAAO;AACd,cAAM,KAAK,KAAK,KAAK;AAAA,MACvB;AACA,WAAK,UAAU,IAAI,kBAAkB,KAAK;AAAA,IAC5C;AACA,WAAO,KAAK;AAAA,EACd;AAAA;AAAA,EAGA,KAAK,cAAc,OAAc;AAC/B,QAAI,CAAC,KAAK,SAAS;AACjB,aAAO,CAAC;AAAA,IACV;AACA,UAAM,YAAY,KAAK,SAAS;AAAA,MAC9B,IAAI;AAAA,QACD,WAAW,KAAuD;AACjE,qBAAW,KAAK,KAAK;AACnB,mBAAO;AAAA,UACT;AAAA,QACF,EAAG,KAAK,UAAU;AAAA,MACpB;AAAA,IACF;AACA,QAAI,CAAC,aAAa;AAChB,YAAM,WAAW,UAAU,MAAM,IAAI;AACrC,YAAM,YAAY,SAAS,OAAO,CAAC,MAAM,EAAE,MAAM;AAEjD,YAAM,SAAS,UAAU,IAAI,CAAC,MAAM,KAAK,MAAM,CAAC,CAAC;AACjD,aAAO;AAAA,IACT;AACA,WAAO,UAAU,MAAM,IAAI,EAAE,OAAO,CAAC,MAAM,EAAE,MAAM;AAAA,EACrD;AACF;;;AC/FO,SAAS,SAAS,KAAsB,QAAgC,OAAO,GAAS;AAC7F,QAAM,MAAM,IAAI,WAAW,IAAI,QAAQ,IAAI,YAAY,IAAI,UAAU;AACrE,MAAI,SAAS;AACb,MAAI,QAAQ,GAAG;AACb,WAAO,IAAI;AAAA,EACb;AACA,SAAO,KAAK,IAAI,MAAM,IAAI,MAAM;AAChC,QAAM,OAAO;AACb,WAAS,OAAO,GAAG,OAAO,MAAM,QAAQ,MAAM;AAC5C,QAAI,OAAO,QAAQ,QAAQ,IAAI,UAAU,MAAM;AAAA,IAE/C,OAAO;AACL,aAAO,IAAI,SAAU,IAAI,SAAS;AAClC,aAAO,IAAI;AACX,eAAS;AAAA,IACX;AACA,UAAM,IAAc,CAAC,KAAK,SAAS,EAAE,EAAE,SAAS,GAAG,GAAG,GAAG,MAAM;AAC/D,aAAS,MAAM,GAAG,MAAM,MAAM,OAAO;AACnC,UAAI,OAAO,MAAM,MAAM;AACrB,UAAE,KAAK,IAAI,OAAO,GAAG,EAAE,SAAS,EAAE,EAAE,SAAS,GAAG,GAAG,CAAC;AAAA,MACtD,OAAO;AACL,UAAE,KAAK,IAAI;AAAA,MACb;AAEA,QAAE,KAAK,GAAG;AAAA,IACZ;AACA,aAAS,MAAM,GAAG,MAAM,MAAM,OAAO;AACnC,UAAI,OAAO,MAAM,MAAM;AACrB,cAAM,KAAK,IAAI,OAAO,GAAG;AACzB,UAAE,KAAK,MAAM,MAAM,KAAK,MAAM,OAAO,aAAa,EAAE,IAAI,GAAG;AAAA,MAC7D;AAAA,IACF;AACA,WAAO,EAAE,KAAK,EAAE,CAAC;AAAA,EACnB;AACF;AAEO,SAAS,WAAW,KAAsB,OAAO,GAAW;AACjE,QAAM,YAAsB,CAAC;AAC7B;AAAA,IACE;AAAA,IACA,CAAC,SAAS;AACR,gBAAU,KAAK,IAAI;AAAA,IACrB;AAAA,IACA;AAAA,EACF;AACA,SAAO,UAAU,KAAK,IAAI;AAC5B;;;ACxCO,IAAM,QAAQ;AAAA,EACnB,MAAM;AAAA,EACN,OAAO;AAAA,EACP,MAAM;AAAA,EACN,OAAO;AACT;AAOO,IAAM,WAAN,MAAe;AAAA,EACpB,YAAqB,IAAkB;AAAlB;AAAA,EAAmB;AAAA,EACxC,QAAmC;AACjC,QAAI;AAEF,aAAO,KAAK,GAAG;AAAA,IACjB,SAAS,GAAG;AACV,aAAO,YAAa,EAAY,OAAO;AAAA,IACzC;AAAA,EACF;AAAA,EACA,SAAoC;AAClC,WAAO,KAAK,MAAM;AAAA,EACpB;AACF;AAiBO,SAAS,cAAc,KAAmD;AAE/E,QAAM,IAAI,MAAM,iBAAiB;AACnC;AASO,SAAS,SAAS,KAAkB,KAA8B;AACvE,SAAO,iBAAiB,KAAK;AAAA,IAC3B,GAAG;AAAA,IACH,OAAO,IAAI,SAAS,oBAAI,IAAa,CAAC,KAAK,OAAO,CAAC,CAAC;AAAA,EACtD,CAAC;AACH;AAIA,SAAS,iBAAiB,KAAkB,KAAsC;AArElF;AAsEE,QAAM;AAAA,IACJ,GAAG;AAAA,IACH,OAAO,IAAI,SAAS,oBAAI,IAAa,CAAC,KAAK,OAAO,CAAC,CAAC;AAAA,EACtD;AACA,UAAQ,OAAO,KAAK;AAAA,IAClB,KAAK;AACH,aAAO,IAAI,SAAS,GAAG;AAAA,IACzB,KAAK,UAAU;AACb,UAAI;AACF,cAAM,MAAM,KAAK,MAAM,GAAG;AAC1B,YAAI,OAAO,QAAQ,YAAY,QAAQ,MAAM;AAC3C,iBAAO,iBAAiB,KAAK,GAAG;AAAA,QAClC;AAAA,MAEF,SAAS,GAAG;AACV,YAAI;AACF,gBAAM,MAAM,IAAI,IAAI,GAAG;AACvB,iBAAO,IAAI,SAAS,MAAM,IAAI,SAAS,CAAC;AAAA,QAE1C,SAASA,IAAG;AAAA,QAEZ;AAAA,MACF;AACA,UAAI,IAAI,MAAM,QAAQ,GAAG;AACvB,cAAM,QAAQ,IAAI,MAAM,SAAS,EAAE,IAAI,CAAC,MAAM,EAAE,KAAK,CAAC;AACtD,eAAO,IAAI,SAAS,MAAM,KAAK;AAAA,MACjC;AACA,aAAO,IAAI,SAAS,MAAM,IAAI,SAAS,CAAC;AAAA,IAC1C;AAAA,IACA,KAAK;AACH,aAAO,IAAI,SAAS,MAAM,GAAG;AAAA,IAC/B,KAAK;AACH,aAAO,IAAI,SAAS,MAAM,GAAG;AAAA,IAC/B,KAAK,UAAU;AACb,UAAI,QAAQ,MAAM;AAChB,eAAO,IAAI,SAAS,MAAM,MAAM;AAAA,MAClC;AACA,UAAI,YAAY,OAAO,GAAG,GAAG;AAC3B,YAAI;AAEF,gBAAM,UAAU,IAAI,YAAY;AAChC,gBAAM,QAAQ,QAAQ,OAAO,GAAG;AAChC,gBAAM,MAAM,KAAK,MAAM,KAAK;AAC5B,iBAAO,iBAAiB,KAAK,GAAG;AAAA,QAElC,SAAS,GAAG;AACV,iBAAO,iBAAiB,WAAW,KAAK,GAAG,GAAG,GAAG;AAAA,QACnD;AAAA,MACF;AACA,UAAI,MAAM,QAAQ,GAAG,GAAG;AACtB,eAAO,IAAI;AAAA,UAAS,MACjB,IAAqB,IAAI,CAAC,MAAM,SAAS,GAAG,EAAE,GAAG,KAAK,OAAO,OAAU,CAAC,EAAE,MAAM,CAAe;AAAA,QAClG;AAAA,MACF;AAOA,UAAI,eAAe,SAAS;AAC1B,eAAO,IAAI,SAAS,MAAM,OAAO,YAAY,IAAI,QAAQ,CAAC,CAA0B;AAAA,MACtF;AACA,UAAI,eAAe,gBAAgB;AACjC,eAAO,IAAI,SAAS,MAAM,UAAU;AAAA,MACtC;AACA,UAAI,eAAe,SAAS;AAC1B,eAAO,IAAI,SAAS,MAAM,WAAW;AAAA,MACvC;AAGA,WAAI,SAAI,UAAJ,mBAAW,IAAI,MAAM;AACvB,eAAO,IAAI,SAAS,MAAM,KAAK;AAAA,MACjC;AACA,gBAAI,UAAJ,mBAAW,IAAI;AACf,UAAI,OAAO,IAAI,WAAW,YAAY;AACpC,eAAO,IAAI,SAAS,MAAM,IAAI,OAAO,CAAC;AAAA,MACxC;AAEA,YAAM,MAAgC,CAAC;AACvC,YAAM,WAAW;AACjB,iBAAW,OAAO,UAAU;AAC1B,YAAI,IAAI,WAAW,OAAO,KAAK,IAAI,WAAW,OAAO,EAAE,KAAK,GAAG,GAAG;AAChE;AAAA,QACF;AACA,cAAM,UAAU,SAAS,GAAG;AAC5B,YAAI,mBAAmB,UAAU;AAC/B,cAAI,GAAG,IAAI;AAAA,QACb,OAAO;AACL,cAAI,OAAO,YAAY,YAAY;AACjC,gBAAI,GAAG,IAAI,iBAAiB,SAAS,GAAG;AAAA,UAC1C;AAAA,QACF;AAAA,MACF;AAEA,aAAO,IAAI,SAAS,MAAM,GAA4B;AAAA,IACxD;AAAA,IACA;AACE,UAAI,CAAC,KAAK;AACR,eAAO,IAAI,SAAS,MAAM,WAAW;AAAA,MACvC;AACA,YAAM,IAAI,MAAM,gBAAgB,OAAO,GAAG,EAAE;AAAA,EAChD;AACF;AA4EO,SAAS,SAAS,KAA6B;AACpD,SACE,OAAO,QAAQ,YACf;AAAA,IACE;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACF,EACG,IAAI,CAAC,OAAO,OAAQ,IAAgC,EAAE,MAAM,UAAU,EACtE,OAAO,CAAC,GAAG,MAAM,KAAK,GAAG,IAAI;AAEpC;;;ACjRO,IAAe,SAAf,MAAe,QAAU;AAAA,EAC9B,OAAO,KAAQ,GAAiB;AAC9B,WAAO,IAAI,KAAK,CAAC;AAAA,EACnB;AAAA,EAEA,OAAO,OAAqB;AAC1B,WAAO,IAAI,KAAK;AAAA,EAClB;AAAA,EAEA,OAAO,GAAM,GAA4B;AACvC,WAAO,aAAa;AAAA,EACtB;AAAA,EAEA,OAAO,KAAQ,GAAkB;AAC/B,QAAI,CAAC,GAAG;AACN,aAAO,IAAI,KAAK;AAAA,IAClB;AACA,WAAO,IAAI,KAAK,CAAC;AAAA,EACnB;AAAA,EAEA,SAAkB;AAChB,WAAO,KAAK,QAAQ;AAAA,EACtB;AAAA,EAEA,SAAkB;AAChB,WAAO,KAAK,QAAQ;AAAA,EACtB;AAAA,EACA,SAAY;AACV,WAAO,KAAK,OAAO;AAAA,EACrB;AAKF;AAEO,IAAM,OAAN,cAAsB,OAAU;AAAA,EAErC,YAAY,IAAO;AACjB,UAAM;AACN,SAAK,KAAK;AAAA,EACZ;AAAA,EAEA,UAAmB;AACjB,WAAO;AAAA,EACT;AAAA,EACA,UAAmB;AACjB,WAAO;AAAA,EACT;AAAA,EACA,SAAY;AACV,WAAO,KAAK;AAAA,EACd;AACF;AAEO,IAAM,OAAN,cAAsB,OAAU;AAAA,EACrC,UAAmB;AACjB,WAAO;AAAA,EACT;AAAA,EACA,UAAmB;AACjB,WAAO;AAAA,EACT;AAAA,EACA,SAAY;AACV,UAAM,IAAI,MAAM,aAAa;AAAA,EAC/B;AACF;;;AC7DO,IAAM,mBAAN,MAA+C;AAAA,EAA/C;AACL,SAAS,gBAA4B,oBAAI,IAAW,CAAC,MAAM,MAAM,MAAM,OAAO,MAAM,IAAI,CAAC;AACzF,SAAS,WAAoC,oBAAI,IAAwB;AAEzE,sBAA6B,OAAO,KAAK,IAAI;AAC7C,0BAAiB;AAAA;AAAA,EACjB,YAAY,UAAiB,SAAyB;AACpD,QAAI,QAAQ,UAAU,GAAG;AACvB,WAAK,cAAc,IAAI,KAAK;AAC5B;AAAA,IACF;AACA,SAAK;AAAA,MACH;AAAA,MACA,CAAC,MAAM;AACL,aAAK,SAAS,IAAI,GAAG,oBAAI,IAAI,CAAC,GAAG,KAAK,eAAe,KAAK,CAAC,CAAC;AAAA,MAC9D;AAAA,MACA,GAAG;AAAA,IACL;AAAA,EACF;AAAA,EACA,aAAa,UAAiB,SAAyB;AACrD,QAAI,QAAQ,UAAU,GAAG;AACvB,WAAK,cAAc,OAAO,KAAK;AAC/B;AAAA,IACF;AACA,SAAK;AAAA,MACH;AAAA,MACA,CAAC,MAAM;AACL,aAAK,SAAS,OAAO,CAAC;AAAA,MACxB;AAAA,MACA,GAAG;AAAA,IACL;AAAA,EACF;AAAA,EAEA,eAAe,QAAwB;AACrC,SAAK,iBAAiB,CAAC,CAAC;AAAA,EAC1B;AAAA,EAEA,cAAc,IAAmB;AAC/B,SAAK,aAAa,OAAO,KAAK,EAAE;AAAA,EAClC;AAAA,EAEA,WAAW,OAAc,aAAkC,SAAsC;AAC/F,eAAW,KAAK,QAAQ,KAAK,GAAG;AAC9B,UAAI,OAAO,MAAM,UAAU;AACzB;AAAA,MACF;AACA,YAAM,QAAQ,EACX,MAAM,GAAG,EACT,IAAI,CAAC,MAAM,EAAE,KAAK,CAAC,EACnB,OAAO,CAAC,MAAM,EAAE,MAAM;AACzB,iBAAW,KAAK,OAAO;AACrB,iBAAS,CAAC;AAAA,MACZ;AAAA,IACF;AAAA,EACF;AAAA,EACA,YAAY,SAAsC;AAChD,SAAK;AAAA,MACH,MAAM;AAAA,MACN,CAAC,MAAM;AACL,aAAK,SAAS,IAAI,GAAG,oBAAI,IAAI,CAAC,GAAG,KAAK,eAAe,MAAM,KAAK,CAAC,CAAC;AAAA,MACpE;AAAA,MACA,GAAG;AAAA,IACL;AAAA,EACF;AAAA,EACA,UAAU,QAAiB,QAA0B;AACnD,UAAM,QAAQ;AACd,QAAI,OAAO,WAAW,UAAU;AAC9B,YAAM,SAAS,KAAK,SAAS,IAAI,MAAM;AACvC,UAAI,UAAU,OAAO,IAAI,KAAK,GAAG;AAC/B,eAAO;AAAA,MACT;AAAA,IACF;AACA,UAAM,SAAS,KAAK,SAAS,IAAI,GAAG;AACpC,QAAI,UAAU,OAAO,UAAU,UAAU;AACvC,UAAI,OAAO,IAAI,KAAK,GAAG;AACrB,eAAO;AAAA,MACT;AAAA,IACF;AACA,QAAI,OAAO,UAAU,UAAU;AAE7B,aAAO;AAAA,IACT;AACA,WAAO,KAAK,cAAc,IAAI,KAAK;AAAA,EACrC;AACF;AAEA,IAAM,iBAAiB,IAAI,iBAAiB;AAErC,SAAS,wBAAsC;AACpD,SAAO;AACT;;;AC5FA,OAAO,UAAU;;;ACDV,IAAM,WAAW;AAAA,EACtB,OAAO;AAAA,EACP,MAAM;AAAA,EACN,IAAI;AAAA,EACJ,MAAM;AAAA;AAER;AAMO,IAAM,OAAN,MAAW;AAAA,EAEhB,YAAY,QAAoB,CAAC,GAAG;AAClC,SAAK,QAAQ;AAAA,EACf;AAAA,EAEA,WAAmB;AACjB,WAAO,KAAK,MACT,IAAI,CAAC,SAAS;AACb,UAAI,OAAO,SAAS,UAAU;AAC5B,eAAO;AAAA,MACT,OAAO;AACL,gBAAQ,MAAM;AAAA,UACZ,KAAK,SAAS;AAAA,UACd,KAAK,SAAS;AACZ,mBAAO;AAAA,UACT,KAAK,SAAS;AACZ,mBAAO;AAAA,UACT;AACE,mBAAO;AAAA,QACX;AAAA,MACF;AAAA,IACF,CAAC,EACA,KAAK,EAAE;AAAA,EACZ;AAAA,EAEA,IAAI,MAAsB;AACxB,QAAI,KAAK,MAAM,SAAS,SAAS,IAAI,KAAK,SAAS,SAAS,MAAM;AAChE,YAAM,IAAI,MAAM,2CAA2C;AAAA,IAC7D;AACA,UAAM,OAAO,KAAK,MAAM,KAAK,MAAM,SAAS,CAAC;AAC7C,QAAI,OAAO,SAAS,SAAS,SAAS,SAAS,OAAO;AACpD;AAAA,IACF;AACA,YAAQ,MAAM;AAAA,MACZ,KAAK;AACH,aAAK,MAAM,KAAK,SAAS,IAAI;AAC7B;AAAA,MACF,KAAK;AACH,eAAO,SAAS;AAAA,IACpB;AAMA,QAAI,SAAS,SAAS,QAAQ,SAAS,SAAS,OAAO;AACrD,UAAI,SAAS,SAAS,MAAM;AAC1B,aAAK,MAAM,IAAI;AAAA,MACjB;AACA;AAAA,IACF;AACA,SAAK,MAAM,KAAK,IAAI;AAAA,EACtB;AACF;AAEO,SAAS,UAAU,MAAoB;AAC5C,QAAM,IAAI,IAAI,KAAK;AACnB,MAAI,SAAS,IAAI;AACf,WAAO;AAAA,EACT;AACA,WAAS,QAAQ,GAAG,KAAK,QAAQ,SAAS;AAExC,QAAI,KAAK,MAAM,MAAM,GAAG;AACtB,UAAI,UAAU,GAAG;AACf,UAAE,IAAI,SAAS,IAAI;AAAA,MACrB,OAAO;AACL,UAAE,IAAI,SAAS,KAAK;AAAA,MACtB;AACA,aAAO,KAAK,QAAQ,QAAQ,EAAE;AAAA,IAChC,OAAO;AACL,YAAM,OAAO,KAAK,QAAQ,SAAS,EAAE;AACrC,QAAE,IAAI,IAAI;AACV,aAAO,KAAK,QAAQ,UAAU,EAAE;AAAA,IAClC;AAAA,EACF;AACA,SAAO;AACT;AAEO,SAAS,YAAY,OAAyB;AACnD,MAAI,OAAO;AACX,QAAM,MAAgB,CAAC;AAEvB,WAAS,IAAI,GAAG,IAAI,MAAM,QAAQ,KAAK;AACrC,UAAM,OAAO,MAAM,CAAC;AACpB,QAAI,SAAS,IAAI;AACf;AAAA,IACF;AAEA,QAAI,EAAE,KAAK,SAAS,GAAG,KAAK,KAAK,WAAW,GAAG,IAAI;AACjD,UAAI,SAAS,IAAI;AACf,YAAI,KAAK,GAAG;AAAA,MACd;AACA,UAAI,KAAK,IAAI;AAAA,IACf,OAAO;AACL,UAAI,KAAK,IAAI;AAAA,IACf;AACA,WAAO;AAAA,EACT;AACA,SAAO,IAAI,KAAK,EAAE;AACpB;AAEO,SAAS,aAAa,MAAc,UAA0B;AACnE,QAAM,gBAAgB,UAAU,QAAQ;AACxC,MAAI;AACJ,MAAI,cAAc,MAAM,CAAC,MAAM,SAAS,MAAM;AAC5C,aAAS;AAAA,EACX,OAAO;AACL,aAAS,SAAS,MAAM,QAAQ;AAAA,EAClC;AACA,QAAM,YAAY,UAAU,MAAM;AAElC,QAAM,MAAkB,CAAC;AACzB,MAAI,QAAQ;AACZ,aAAW,QAAQ,UAAU,OAAO;AAClC,YAAQ,MAAM;AAAA,MACZ,KAAK,SAAS;AACZ,YAAI,KAAK,SAAS,IAAI;AACtB;AAAA,MACF,KAAK,SAAS;AACZ,YAAI,IAAI,UAAU,CAAC,OAAO;AACxB,gBAAM,OAAO,IAAI,SAAS;AAC1B,cAAI,OAAO,IAAI,IAAI,MAAM,YAAa,IAAI,OAAO,CAAC,KAAkB,SAAS,MAAM;AACjF,gBAAI,IAAI;AAAA,UACV,OAAO;AACL,gBAAI,IAAI;AACR,gBAAI,IAAI;AAAA,UACV;AACA,cAAI,IAAI,WAAW,GAAG;AACpB,oBAAQ,CAAC,QAAQ,OAAO;AACxB,gBAAI,KAAK,SAAS,EAAE;AAAA,UACtB;AAAA,QACF,OAAO;AACL,cAAI,KAAK,SAAS,EAAE;AAAA,QACtB;AACA;AAAA,MACF,KAAK,SAAS;AACZ,YAAI,EAAG,IAAI,IAAI,SAAS,CAAC,IAAiB,SAAS,QAAQ;AACzD,cAAI,KAAK,SAAS,KAAK;AAAA,QACzB;AACA;AAAA,MACF;AACE,YAAI,KAAK,IAAI;AACb;AAAA,IACJ;AAAA,EACF;AACA,SAAO,IAAI,KAAK,GAAG,EAAE,SAAS;AAIhC;;;ACvGA,SAAS,MAAM,MAAiB,MAA8B;AAC5D,QAAM,KAAgC;AAAA,IACpC,OAAO;AAAA,IACP,UAAU;AAAA,IACV,UAAU;AAAA,IACV,MAAM;AAAA,IACN,UAAU;AAAA,IACV,WAAW,CAAC;AAAA,IACZ,QAAQ,CAAC;AAAA,EACX;AACA,QAAM,MAAM,IAAI,KAAK,IAAI;AACzB,QAAM,MAAM,IAAI,KAAK,IAAI;AACzB,MAAI,IAAI,aAAa,IAAI,UAAU;AACjC,OAAG,SAAS;AACZ,OAAG,WAAW;AAAA,EAChB;AACA,MAAI;AACF,UAAM,OAAO,IAAI;AACjB,UAAM,OAAO,IAAI;AACjB,QAAI,SAAS,IAAI,UAAU;AACzB,SAAG,SAAS;AACZ,SAAG,WAAW;AAAA,IAChB;AACA,QAAI,KAAK,UAAU,SAAS,IAAI,MAAM;AACpC,SAAG,SAAS;AACZ,SAAG,OAAO;AAAA,IACZ;AAAA,EAEF,SAAS,GAAG;AAAA,EAEZ;AACA,MAAI,IAAI,SAAS,UAAU,IAAI,aAAa,KAAK;AAC/C,UAAM,OAAO,IAAI,SAAS,MAAM,GAAG,EAAE,OAAO,CAAC,MAAM,EAAE,MAAM;AAC3D,UAAM,OAAO,IAAI,SAAS,MAAM,GAAG,EAAE,OAAO,CAAC,MAAM,EAAE,MAAM;AAC3D,aAAS,IAAI,GAAG,IAAI,KAAK,UAAU,IAAI,KAAK,QAAQ,KAAK;AACvD,UAAI,KAAK,CAAC,MAAM,KAAK,CAAC,GAAG;AACvB,WAAG,SAAS;AACZ,WAAG,WAAW;AACd,WAAG,UAAU,KAAK,KAAK,CAAC,CAAC;AAAA,MAC3B;AAAA,IACF;AAAA,EACF;AACA,aAAW,CAAC,KAAK,KAAK,KAAK,IAAI,WAAW;AACxC,QAAI,IAAI,SAAS,GAAG,MAAM,OAAO;AAC/B,SAAG,SAAS;AACZ,SAAG,OAAO,GAAG,IAAI;AAAA,IACnB;AAAA,EACF;AACA,SAAO;AACT;AAEA,SAAS,UAAU,KAA8B,KAA6C;AAC5F,MAAI,OAAO,QAAQ,UAAU;AAC3B,UAAM,OAAO,OAAO,KAAK,GAAG;AAC5B,QAAI,KAAK,WAAW,GAAG;AACrB,YAAM,IAAI,MAAM,gBAAgB,KAAK,UAAU,GAAG,CAAC,EAAE;AAAA,IACvD;AACA,WAAO,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,IAAI,KAAK,CAAC,CAAC,EAAE;AAAA,EAC3C;AACA,SAAO,EAAE,KAAK,IAAS;AACzB;AAmBA,SAAS,YAAe,OAAuC;AAC7D,SAAO,UAAU,UAAa,UAAU,OAAO,SAAY;AAC7D;AAEA,SAAS,0BAA0B,KAAmB,iBAAqC;AACzF,MAAI,CAAC,KAAK;AACR,WAAO,IAAI,WAAW,GAAG,eAAe,IAAI;AAAA,EAC9C;AACA,MAAI,OAAO,QAAQ,UAAU;AAC3B,QAAI;AACF,aAAO,IAAI,WAAW,GAAG;AAAA,IAE3B,SAAS,GAAG;AACV,aAAO,IAAI,WAAW,GAAG,eAAe,KAAK,GAAG,EAAE;AAAA,IACpD;AAAA,EACF,OAAO;AACL,WAAO,IAAI,WAAW,IAAI,SAAS,CAAC;AAAA,EACtC;AACF;AAEO,SAAS,MAAM,OAA8B;AAClD,SACE,iBAAiB,OAChB,CAAC,CAAC,SACD,OAAQ,MAAc,iBAAiB,YACvC,OAAQ,MAAc,aAAa,SAAS,cAC5C,OAAQ,MAAc,SAAS;AAErC;AAIO,IAAM,aAAN,MAAM,oBAAmB,IAAI;AAAA,EAUlC,YAAY,QAAgB;AAC1B,UAAM,yBAAyB;AAC/B,UAAM,YAAY,OAAO,MAAM,GAAG;AAClC,SAAK,eAAe,qBAAqB,IAAI,UAAU,CAAC,CAAC;AACzD,QAAI,cAAc,CAAC,QAAQ,GAAG,UAAU,MAAM,CAAC,CAAC,EAAE,KAAK,GAAG;AAC1D,QAAI,CAAC,KAAK,cAAc;AACtB,YAAM,WAAW,YAAY,QAAQ,iBAAiB,EAAE,EAAE,QAAQ,WAAW,EAAE;AAC/E,oBAAc,YAAY,QAAQ,aAAa,oBAAoB,QAAQ,EAAE;AAAA,IAC/E;AACA,QAAI;AACF,WAAK,UAAU,IAAI,IAAI,WAAW;AAAA,IACpC,SAAS,IAAI;AACX,YAAM,IAAI;AACV,QAAE,UAAU,GAAG,EAAE,OAAO,aAAa,MAAM;AAC3C,YAAM;AAAA,IACR;AACA,SAAK,YAAY,GAAG,UAAU,CAAC,CAAC;AAChC,QAAI,KAAK,cAAc;AACrB,WAAK,YAAY,KAAK,QAAQ;AAAA,IAChC,OAAO;AACL,WAAK,YAAY,OAAO,QAAQ,IAAI,OAAO,IAAI,KAAK,SAAS,IAAI,GAAG,EAAE,EAAE,QAAQ,WAAW,EAAE;AAAA,IAC/F;AACA,SAAK,OAAO,KAAK,QAAQ;AAAA,EAC3B;AAAA,EAEA,QAAoB;AAClB,WAAO,IAAI,YAAW,KAAK,SAAS,CAAC;AAAA,EACvC;AAAA,EAEA,IAAa,OAAe;AAC1B,QAAI,CAAC,KAAK,cAAc;AACtB,YAAM,IAAI;AAAA,QACR,4CAA4C,KAAK,SAAS,CAAC,IAAI,KAAK,UAAU,MAAM,KAAK,qBAAqB,KAAK,CAAC,CAAC,CAAC;AAAA,MACxH;AAAA,IACF;AACA,WAAO,KAAK,QAAQ;AAAA,EACtB;AAAA,EAEA,IAAa,OAAe;AAC1B,QAAI,CAAC,KAAK,cAAc;AACtB,YAAM,IAAI,MAAM,4CAA4C,KAAK,UAAU,MAAM,KAAK,qBAAqB,KAAK,CAAC,CAAC,CAAC,EAAE;AAAA,IACvH;AACA,WAAO,KAAK,QAAQ;AAAA,EACtB;AAAA,EAEA,IAAa,KAAK,GAAW;AAC3B,QAAI,CAAC,KAAK,cAAc;AACtB,YAAM,IAAI,MAAM,wCAAwC,KAAK,UAAU,MAAM,KAAK,qBAAqB,KAAK,CAAC,CAAC,CAAC,EAAE;AAAA,IACnH;AACA,SAAK,QAAQ,OAAO;AAAA,EACtB;AAAA,EAEA,IAAa,WAAmB;AAC9B,QAAI,CAAC,KAAK,cAAc;AACtB,YAAM,IAAI,MAAM,4CAA4C,KAAK,UAAU,MAAM,KAAK,qBAAqB,KAAK,CAAC,CAAC,CAAC,EAAE;AAAA,IACvH;AACA,WAAO,KAAK,QAAQ;AAAA,EACtB;AAAA,EAEA,IAAa,SAAS,GAAW;AAC/B,QAAI,CAAC,KAAK,cAAc;AACtB,YAAM,IAAI,MAAM,4CAA4C,KAAK,UAAU,MAAM,KAAK,qBAAqB,KAAK,CAAC,CAAC,CAAC,EAAE;AAAA,IACvH;AACA,SAAK,QAAQ,WAAW;AAAA,EAC1B;AAAA,EAEA,IAAa,SAAS,GAAW;AAC/B,SAAK,YAAY;AAAA,EACnB;AAAA,EAEA,IAAa,WAAmB;AAC9B,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,IAAa,WAAmB;AAC9B,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,IAAa,SAAS,GAAW;AAC/B,QAAI,CAAC,EAAE,SAAS,GAAG,GAAG;AACpB,UAAI,GAAG,CAAC;AAAA,IACV;AACA,SAAK,YAAY;AAAA,EACnB;AAAA,EAEA,IAAa,eAAgC;AAC3C,WAAO,KAAK,QAAQ;AAAA,EACtB;AAAA,EAES,WAAmB;AAC1B,QAAI,SAAS;AACb,QAAI,KAAK,QAAQ,aAAa,MAAM;AAClC,iBAAW,CAAC,KAAK,KAAK,KAAK,MAAM,KAAK,KAAK,QAAQ,aAAa,QAAQ,CAAC,EAAE,KAAK,CAAC,GAAG,MAAM,EAAE,CAAC,EAAE,cAAc,EAAE,CAAC,CAAC,CAAC,GAAG;AACnH,kBAAU,GAAG,CAAC,OAAO,SAAS,MAAM,GAAG,GAAG,GAAG,IAAI,mBAAmB,KAAK,CAAC;AAAA,MAC5E;AAAA,IACF;AACA,QAAI,WAAW;AACf,QAAI,KAAK,cAAc;AACrB,iBAAW,KAAK,QAAQ;AACxB,UAAI,KAAK,QAAQ,MAAM;AACrB,oBAAY,IAAI,KAAK,QAAQ,IAAI;AAAA,MACnC;AACA,UAAI,CAAC,KAAK,UAAU,WAAW,GAAG,GAAG;AACnC,oBAAY;AAAA,MACd;AAAA,IACF;AACA,WAAO,GAAG,KAAK,SAAS,KAAK,QAAQ,GAAG,KAAK,SAAS,GAAG,MAAM;AAAA,EACjE;AACF;AAEA,SAAS,KAAQ,KAA6B,WAAkC,iBAA4B;AAC1G,UAAQ,OAAO,YAAY,SAAS,GAAG;AAAA,IACrC,KAAK;AACH,aAAO,IAAI,IAAI,WAAW,GAAG,eAAe,KAAK,CAAC;AAAA,IACpD,KAAK;AACH,aAAO,IAAI,0BAA0B,WAAqB,eAAe,CAAC;AAAA,IAC5E,KAAK;AACH,UAAI,SAAS,GAAG,SAAS,GAAG;AAC1B,eAAO,IAAI,IAAI,WAAW,UAAU,KAAK,SAAS,CAAC,CAAC;AAAA,MACtD,WAAW,IAAI,GAAG,SAAS,GAAG;AAC5B,eAAO,IAAI,IAAI,WAAW,UAAU,KAAK,SAAS,CAAC,CAAC;AAAA,MACtD,WAAW,MAAM,SAAS,GAAG;AAC3B,eAAO,IAAI,IAAI,WAAW,UAAU,SAAS,CAAC,CAAC;AAAA,MACjD;AACA,YAAM,IAAI,MAAM,wBAAwB,SAAS,EAAE;AAAA,IACrD;AACE,YAAM,IAAI,MAAM,qBAAqB,OAAO,SAAS,EAAE;AAAA,EAC3D;AACF;AAEA,SAAS,eACP,KACA,KACA,QAAiC,CAACC,SAAQ;AACxC,SAAO,sBAAsBA,IAAG;AAClC,GACgB;AAChB,MAAI,QAAQ,QAAW;AACrB,WAAO,OAAO,IAAI,MAAM,GAAG,CAAC;AAAA,EAC9B;AACA,SAAO,OAAO,GAAG,GAAG;AACtB;AAEO,IAAM,WAAN,MAAM,UAA2C;AAAA;AAAA,EAE9C,YAAY,KAAiB;AACnC,SAAK,OAAO;AAAA,EACd;AAAA,EAEA,OAAO,GAAG,OAAmC;AAC3C,WACE,iBAAiB,aAChB,CAAC,CAAC,SAAS,OAAQ,MAAmB,aAAa,cAAc,OAAQ,MAAmB,aAAa;AAAA,EAE9G;AAAA,EACA,OAAO,KAAK,WAAuB,kBAAkB,SAAmB;AACtE,WAAO,KAAK,CAAC,QAAQ,IAAI,UAAS,GAAG,GAAG,WAAW,eAAe;AAAA,EACpE;AAAA,EAEA,MAAM,OAA+B;AACnC,WAAO,MAAM,KAAK,IAAI,GAAG,IAAI,KAAK,KAAK,CAAC;AAAA,EAC1C;AAAA,EAEA,KAAK,GAAqB;AACxB,SAAK,KAAK,OAAO;AACjB,WAAO;AAAA,EACT;AAAA,EAEA,SAAS,GAAqB;AAC5B,SAAK,KAAK,WAAW;AACrB,WAAO;AAAA,EACT;AAAA,EAEA,SAAS,GAAqB;AAC5B,QAAI,CAAC,EAAE,SAAS,GAAG,GAAG;AACpB,UAAI,GAAG,CAAC;AAAA,IACV;AACA,SAAK,KAAK,WAAW;AACrB,WAAO;AAAA,EACT;AAAA,EAEA,SAAS,GAAqB;AAC5B,SAAK,KAAK,WAAW;AACrB,WAAO;AAAA,EACT;AAAA;AAAA;AAAA,EAIA,QAAQ,GAAwB;AAC9B,QAAI,CAAC,GAAG;AACN,aAAO;AAAA,IACT;AACA,QAAI,OAAO,MAAM,UAAU;AAEzB,UAAI,CAAC,EAAE,MAAM,gBAAgB,GAAG;AAC9B,YAAI,EAAE,WAAW,GAAG,GAAG;AACrB,eAAK,SAAS,CAAC;AACf,iBAAO;AAAA,QACT;AACA,eAAO,KAAK,eAAe,CAAC;AAAA,MAC9B;AAAA,IACF;AACA,SAAK,OAAO,IAAI,WAAW,EAAE,SAAS,CAAC;AACvC,WAAO;AAAA,EACT;AAAA,EAEA,eAAe,GAAwB;AACrC,UAAM,YAAY,IAAI,KAAK,CAAC;AAC5B,UAAM,WAAW,OAAO,UAAU;AAClC,UAAM,WAAW,KAAK,KAAK;AAY3B,SAAK,SAAS,aAAa,UAAU,QAAQ,CAAC;AAQ9C,eAAW,CAAC,KAAK,KAAK,KAAK,UAAU,WAAW;AAC9C,WAAK,SAAS,KAAK,KAAK;AAAA,IAC1B;AACA,WAAO;AAAA,EACT;AAAA,EAEA,cAAwB;AACtB,eAAW,OAAO,MAAM,KAAK,KAAK,KAAK,aAAa,KAAK,CAAC,GAAG;AAC3D,WAAK,KAAK,aAAa,OAAO,GAAG;AAAA,IACnC;AACA,WAAO;AAAA,EACT;AAAA,EAEA,SAAS,KAAuB;AAC9B,SAAK,KAAK,aAAa,OAAO,GAAG;AACjC,WAAO;AAAA,EACT;AAAA,EAEA,SAAS,KAAa,KAAuB;AAC3C,QAAI,CAAC,KAAK,KAAK,aAAa,IAAI,GAAG,GAAG;AACpC,WAAK,KAAK,aAAa,IAAI,KAAK,GAAG;AAAA,IACrC;AACA,WAAO;AAAA,EACT;AAAA,EAEA,SAAS,KAAa,KAAuB;AAC3C,SAAK,KAAK,aAAa,IAAI,KAAK,GAAG;AACnC,WAAO;AAAA,EACT;AAAA,EAEA,SAAS,KAAsB;AAC7B,WAAO,KAAK,KAAK,aAAa,IAAI,GAAG;AAAA,EACvC;AAAA,EAEA,IAAI,YAAwC;AAC1C,WAAO,KAAK,KAAK,aAAa,QAAQ;AAAA,EACxC;AAAA,EAEA,SAAuC,KAA8B,KAAyD;AAC5H,UAAM,EAAE,KAAK,GAAG,KAAK,EAAE,IAAI,UAAU,KAAK,GAAG;AAC7C,QAAI,MAAM,KAAK,KAAK,aAAa,IAAI,CAAC;AACtC,QAAI,CAAC,YAAY,GAAG,KAAK,GAAG;AAC1B,YAAM;AAAA,IACR;AACA,WAAO,YAAY,GAAG;AAAA,EACxB;AAAA,EAEA,eAAe,KAAa,OAAiD;AAC3E,WAAO,eAAe,KAAK,KAAK,SAAS,GAAG,GAAG,KAAK;AAAA,EACtD;AAAA,EAEA,mBAAmB,MAAiD;AAClE,WAAO,gBAAgB,MAAM,IAAI;AAAA,EACnC;AAAA,EAEA,WAAmB;AACjB,SAAK,KAAK,aAAa,KAAK;AAC5B,WAAO,KAAK,KAAK,SAAS;AAAA,EAC5B;AAAA,EACA,SAAiB;AACf,WAAO,KAAK,SAAS;AAAA,EACvB;AAAA,EAEA,QAAa;AACX,WAAO,KAAK,IAAI,EAAE,MAAM;AAAA,EAC1B;AAAA,EAEA,SAAS,QAAgE;AACvE,WAAO,KAAK,IAAI,EAAE,MAAM,GAAG,MAAM;AAAA,EACnC;AAAA,EAEA,QAAkB;AAChB,WAAO,UAAS,KAAK,KAAK,SAAS,CAAC;AAAA,EACtC;AAAA,EAEA,MAAW;AACT,WAAO,IAAI,KAAK,KAAK,IAAI;AAAA,EAC3B;AACF;AAIO,SAAS,YAAY,OAAoC;AAC9D,MAAI,CAAC,OAAO;AACV,WAAO;AAAA,EACT;AACA,MAAI,MAAM,KAAK,GAAG;AAEhB,WAAO;AAAA,EACT;AACA,MAAI,IAAI,GAAG,KAAK,GAAG;AACjB,WAAO;AAAA,EACT;AACA,MAAI,SAAS,GAAG,KAAK,GAAG;AACtB,WAAO;AAAA,EACT;AACA,MAAI,OAAO,UAAU,UAAU;AAC7B,WAAO;AAAA,EACT;AACA,SAAO;AACT;AAEO,IAAM,uBAAoC,oBAAI,IAAY,CAAC,QAAQ,SAAS,MAAM,KAAK,CAAC;AAGxF,IAAM,MAAN,MAAM,KAAiC;AAAA,EAC5C,OAAO,oBAAoB,UAA8B;AACvD,eAAW,SAAS,QAAQ,MAAM,EAAE;AACpC,yBAAqB,IAAI,QAAQ;AACjC,WAAO,MAAM;AACX,2BAAqB,OAAO,QAAQ;AAAA,IACtC;AAAA,EACF;AAAA,EAEA,MAAM,OAA+B;AACnC,WAAO,MAAM,MAAM,KAAK;AAAA,EAC1B;AAAA;AAAA,EAGA,OAAO,MAAM,MAAiBC,OAAiB,kBAAkB,SAAc;AAC7E,UAAM,UAAU,SAAS,KAAK,MAAM,eAAe;AACnD,UAAM,UAAU,KAAI,KAAKA,OAAM,eAAe;AAE9C,YAAQ,SAAS,QAAQ,QAAQ;AACjC,UAAM,QAAQ,QAAQ;AACtB,QAAI,EAAE,MAAM,WAAW,KAAK,UAAU,OAAO,UAAU,OAAO;AAC5D,cAAQ,SAAS,QAAQ,QAAQ;AAAA,IACnC;AACA,eAAW,CAAC,KAAK,KAAK,KAAK,QAAQ,WAAW;AAC5C,cAAQ,SAAS,KAAK,KAAK;AAAA,IAC7B;AACA,WAAO,QAAQ,IAAI;AAAA,EACrB;AAAA,EAEA,OAAO,GAAG,OAA8B;AACtC,WACE,iBAAiB,QAChB,CAAC,CAAC,SACD,OAAQ,MAAc,UAAU,cAChC,OAAQ,MAAc,aAAa,cACnC,OAAQ,MAAc,aAAa;AAAA,EAEzC;AAAA;AAAA,EAGA,OAAO,KAAK,WAAuB,kBAAkB,SAAc;AACjE,WAAO,KAAK,CAAC,QAAQ,IAAI,KAAI,GAAG,GAAG,WAAW,eAAe;AAAA,EAC/D;AAAA,EAEA,OAAO,WAAW,WAAuB,kBAAkB,SAAsB;AAC/E,WAAO,iBAAiB,MAAM,KAAK,CAAC,QAAQ,IAAI,KAAI,GAAG,GAAG,WAAW,eAAe,CAAC;AAAA,EACvF;AAAA,EAGQ,YAAY,KAAiB;AACnC,SAAK,OAAO,IAAI,MAAM;AAAA,EACxB;AAAA,EAEA,QAAkB;AAChB,WAAO,SAAS,KAAK,KAAK,IAAI;AAAA,EAChC;AAAA,EAEA,IAAI,WAAmB;AACrB,WAAO,KAAK,KAAK;AAAA,EACnB;AAAA;AAAA;AAAA;AAAA,EAMA,IAAI,OAAe;AACjB,WAAO,KAAK,KAAK;AAAA,EACnB;AAAA,EAEA,IAAI,OAAe;AACjB,WAAO,KAAK,KAAK;AAAA,EACnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,IAAI,WAAmB;AACrB,WAAO,KAAK,KAAK;AAAA,EACnB;AAAA,EAEA,IAAI,WAAmB;AACrB,WAAO,KAAK,KAAK;AAAA,EAKnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,IAAI,YAAwC;AAC1C,WAAO,KAAK,KAAK,aAAa,QAAQ;AAAA,EACxC;AAAA,EAEA,SAAS,KAAsB;AAC7B,WAAO,KAAK,KAAK,aAAa,IAAI,GAAG;AAAA,EACvC;AAAA,EAEA,SAAuC,KAA8B,KAAyD;AAC5H,UAAM,EAAE,KAAK,GAAG,KAAK,EAAE,IAAI,UAAU,KAAK,GAAG;AAC7C,QAAI,MAAM,KAAK,KAAK,aAAa,IAAI,CAAC;AACtC,QAAI,CAAC,YAAY,GAAG,KAAK,GAAG;AAC1B,YAAM;AAAA,IACR;AACA,WAAO,YAAY,GAAG;AAAA,EACxB;AAAA,EAEA,eAAe,KAAa,OAAiD;AAC3E,WAAO,eAAe,KAAK,KAAK,SAAS,GAAG,GAAG,KAAK;AAAA,EACtD;AAAA,EAEA,mBAAmB,MAAiD;AAClE,WAAO,gBAAgB,MAAM,IAAI;AAAA,EACnC;AAAA,EAEA,QAAa;AACX,WAAO,IAAI,KAAI,KAAK,IAAI;AAAA,EAC1B;AAAA,EAEA,QAAa;AAGX,WAAO,KAAK,KAAK,MAAM;AAAA,EACzB;AAAA,EAEA,WAAmB;AAEjB,WAAO,KAAK,KAAK,SAAS;AAAA,EAC5B;AAAA,EACA,SAAiB;AACf,WAAO,KAAK,SAAS;AAAA,EACvB;AAAA,EACA,SAAS,QAAgE;AACvE,UAAM,UAAyB;AAAA,MAC7B,OAAO;AAAA,MACP,UAAU,KAAK;AAAA,MACf,UAAU,KAAK;AAAA,MACf,cAAc,OAAO,YAAY,KAAK,SAAS;AAAA,IACjD;AACA,QAAI,qBAAqB,IAAI,KAAK,SAAS,QAAQ,MAAM,EAAE,CAAC,GAAG;AAC7D,aAAO,SAAS,QAAQ;AAAA,QACtB,GAAG;AAAA,QACH,OAAO;AAAA,QACP,UAAU,KAAK;AAAA,QACf,MAAM,KAAK;AAAA,MACb,CAAC;AAAA,IACH;AACA,WAAO,SAAS,QAAQ,OAAO;AAAA,EACjC;AACF;;;AClqBO,IAAM,kBAAN,MAAsB;AAAA,EAI3B,YAAY,KAAiC;AAF7C,SAAS,WAAoC,CAAC;AAyB9C,2BAAkB;AAClB,yBAAgC,CAAC;AAvB/B,SAAK,OAAO;AAAA,EACd;AAAA,EAEA,MAAM,SAA2B;AAC/B,UAAM,KAAK,YAA2B;AAGpC,UAAI;AACF,cAAM,SAAS,KAAK,KAAK,UAAU;AACnC,cAAM,OAAO;AACb,cAAM,OAAO,MAAM,OAAO;AAC1B,eAAO,YAAY;AAAA,MACrB,SAAS,KAAK;AAEZ,gBAAQ,MAAM,gBAAgB,GAAG;AAAA,MACnC;AAAA,IAEF;AACA,SAAK,SAAS,KAAK,EAAE;AACrB,SAAK,OAAO;AAAA,EACd;AAAA,EAIA,OAAO,UAA+C,QAAW,MAAyB;AACxF,QAAI,MAAM;AACR,WAAK,cAAc,KAAK,IAAI;AAAA,IAC9B;AAEA,QAAI,KAAK,SAAS,UAAU,GAAG;AAE7B,WAAK,kBAAkB;AACvB,WAAK,cAAc,QAAQ,CAAC,OAAO,GAAG,CAAC;AACvC,WAAK,gBAAgB,CAAC;AACtB;AAAA,IACF;AAEA,QAAI,CAAC,WAAW,KAAK,SAAS,UAAU,KAAK,CAAC,KAAK,iBAAiB;AAClE,WAAK,kBAAkB;AAAA,IAEzB,WAAW,CAAC,SAAS;AAEnB;AAAA,IACF;AAGA,UAAM,KAAK,KAAK,SAAS,MAAM;AAC/B,+BACG,MAAM,CAAC,MAAM;AAEZ,cAAQ,MAAM,gBAAgB,CAAC;AAAA,IACjC,GACC,QAAQ,MAAM;AAEb,WAAK,OAAO,KAAK,QAAQ;AAAA,IAC3B;AAAA,EACJ;AACF;;;AH/BA,SAAS,OAAO,OAAgB,KAA8B;AAC5D,MAAI,MAAM,QAAQ,KAAK,GAAG;AACxB,WAAO,SAAS,MAAM,MAAM,QAAQ,GAAG;AAAA,EACzC,WAAW,OAAO,UAAU,UAAU;AACpC,WAAO,SAAS,MAAM,MAAM,QAAQ,GAAG;AAAA,EACzC,WAAW,OAAO,UAAU,YAAY,UAAU,MAAM;AACtD,QAAI,OAAQ,MAAgB,SAAS,UAAU;AAC7C,aAAO,SAAS,MAAO,MAAgB,MAAM,GAAG;AAAA,IAClD,WAAW,OAAQ,MAAmB,WAAW,UAAU;AACzD,aAAO,SAAS,MAAO,MAAmB,QAAQ,GAAG;AAAA,IACvD;AACA,WAAO,SAAS,MAAM,OAAO,KAAK,KAAK,EAAE,QAAQ,GAAG;AAAA,EACtD;AACA,SAAO,SAAS,MAAM,IAAI,GAAG;AAC/B;AAUA,SAAS,WAAW,KAAyD;AAC3E,MAAI,OAAO,OAAQ,IAA0B,SAAS,YAAY;AAChE,UAAM,IAAI,MAAM,gCAAgC;AAAA,EAClD;AACA,SAAO;AACT;AAEO,IAAM,gBAAN,MAA4C;AAAA,EAGjD,YAAY,SAAuB,OAAgB;AACjD,SAAK,WAAW;AAChB,SAAK,SAAS;AAAA,EAChB;AAAA,EACA,OAAO,MAAmC;AACxC,QAAI;AACJ,QAAI;AACF,YAAM,KAAK,UAAU,MAAM,MAAM,KAAK,MAAM;AAAA,IAC9C,SAAS,GAAG;AACV,YAAM,KAAK,UAAU,EAAE,UAAU,EAAE,SAAU,EAAY,SAAS,OAAQ,EAAY,MAAM,EAAE,CAAC;AAAA,IACjG;AACA,WAAO,KAAK,SAAS,OAAO,MAAM,IAAI;AAAA,EACxC;AACF;AAEO,IAAM,gBAAN,MAA4C;AAAA,EAGjD,YAAY,SAAuB,OAAgB;AACjD,SAAK,WAAW;AAChB,SAAK,SAAS;AAAA,EAChB;AAAA,EACA,OAAO,MAAmC;AACxC,WAAO,KAAK,SAAS,OAAO,UAAU,KAAK,UAAU,MAAM,MAAM,KAAK,MAAM,IAAI,IAAI;AAAA,EACtF;AACF;AAYA,SAAS,cAAc,KAAkC;AACvD,SAAO;AAAA,IACL,YAAY,IAAI;AAAA,EAClB;AACF;AAEO,IAAM,aAAN,MAAM,YAA6B;AAAA;AAAA,EAUxC,YAAY,QAA2B;AARvC,SAAS,cAA+B,CAAC;AASvC,QAAI,CAAC,QAAQ;AACX,eAAS,CAAC;AAAA,IACZ;AACA,QAAI,CAAC,OAAO,KAAK;AACf,WAAK,OAAO,kBAAkB;AAAA,IAChC,OAAO;AACL,WAAK,OAAO,OAAO;AAAA,IACrB;AACA,QAAI,CAAC,OAAO,SAAS;AACnB,WAAK,WAAW,sBAAsB;AAAA,IACxC,OAAO;AACL,WAAK,WAAW,OAAO;AAAA,IACzB;AACA,QAAI,CAAC,OAAO,WAAW;AACrB,WAAK,aAAa,IAAI,cAAc,KAAK,QAAQ;AAAA,IACnD,OAAO;AACL,WAAK,aAAa,OAAO;AAAA,IAC3B;AAEA,QAAI,OAAO,WAAW;AACpB,WAAK,aAAa,OAAO;AAAA,IAC3B,OAAO;AACL,UAAI,CAAC,OAAO,KAAK;AACf,cAAM,KAAK,UAAU;AACrB,YAAI;AACJ,YAAI,GAAG,WAAW;AAChB,mBAAS,IAAI,oBAAoB;AAAA,QACnC,OAAO;AACL,cAAI,GAAG,aAAa,GAAG,iBAAiB,GAAG,UAAU,GAAG,YAAY;AAClE,qBAAS,KAAK,KAAK,OAAO;AAAA,UAC5B,OAAO;AACL,kBAAM,IAAI,MAAM,+BAA+B;AAAA,UACjD;AAAA,QACF;AACA,aAAK,aAAa,IAAI,gBAAgB,MAAM;AAAA,MAC9C,OAAO;AACL,aAAK,aAAa,IAAI,gBAAgB,OAAO,GAAG;AAAA,MAClD;AAAA,IACF;AACA,QAAI,CAAC,OAAO,gBAAgB;AAC1B,WAAK,kBAAkB,CAAC;AAAA,IAC1B,OAAO;AACL,WAAK,kBAAkB,EAAE,GAAG,OAAO,eAAe;AAAA,IACpD;AACA,SAAK,cAAc,EAAE,GAAG,KAAK,gBAAgB;AAC7C,QAAI,OAAO,cAAc;AACvB,WAAK,eAAe,OAAO;AAAA,IAC7B,OAAO;AACL,WAAK,eAAe,sBAAsB;AAAA,IAC5C;AAAA,EAEF;AAAA,EAEA,UAAwB;AACtB,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,aAAsC;AACpC,WAAO,KAAK,MAAM,KAAK,UAAU,KAAK,aAAa,IAAI,CAAC;AAAA,EAU1D;AAAA,EAEA,eAAe,QAA0B;AACvC,SAAK,aAAa,eAAe,MAAM;AACvC,WAAO;AAAA,EACT;AAAA,EAEA,YAAY,UAAiB,SAA2B;AACtD,SAAK,aAAa,YAAY,OAAO,GAAG,OAAO;AAC/C,WAAO;AAAA,EACT;AAAA,EACA,aAAa,UAAiB,SAA2B;AACvD,SAAK,aAAa,aAAa,OAAO,GAAG,OAAO;AAChD,WAAO;AAAA,EACT;AAAA,EAEA,OAAO,KAAqB;AAC1B,SAAK,YAAY,QAAQ,IAAI,SAAS,KAAK,cAAc,KAAK,YAAY,CAAC;AAC3E,SAAK,gBAAgB,QAAQ,IAAI,SAAS,KAAK,cAAc,KAAK,YAAY,CAAC;AAC/E,WAAO;AAAA,EACT;AAAA;AAAA,EAEA,YAAY,SAAwC;AAClD,SAAK,aAAa,SAAS,GAAG,OAAO;AACrC,WAAO;AAAA,EACT;AAAA,EAEA,mBAAmB,IAAqB;AACtC,SAAK,aAAa,cAAc,EAAE;AAClC,WAAO;AAAA,EACT;AAAA,EAEA,aAAa,WAAiC;AAC5C,SAAK,aAAa;AAClB,WAAO;AAAA,EACT;AAAA,EAEA,YAAoB;AAClB,SAAK,YAAY,IAAI,IAAI,SAAS,MAAM,KAAK,KAAK,KAAK,EAAE,IAAI,EAAE,YAAY,GAAG,cAAc,KAAK,YAAY,CAAC;AAC9G,WAAO;AAAA,EACT;AAAA,EACA,OAAe;AACb,SAAK,YAAY,OAAO,IAAI,SAAS,MAAM,MAAM,cAAc,KAAK,YAAY,CAAC;AACjF,WAAO;AAAA,EACT;AAAA,EACA,MAAc;AACZ,WAAO;AAAA,EACT;AAAA,EACA,QAAgB;AACd,SAAK,YAAY,OAAO,IAAI,SAAS,MAAM,OAAO,cAAc,KAAK,YAAY,CAAC;AAClF,WAAO;AAAA,EACT;AAAA,EACA,QAAgB;AACd,SAAK,YAAY,OAAO,IAAI,SAAS,MAAM,OAAO,cAAc,KAAK,YAAY,CAAC;AAClF,WAAO;AAAA,EACT;AAAA,EACA,OAAe;AACb,SAAK,YAAY,OAAO,IAAI,SAAS,MAAM,MAAM,cAAc,KAAK,YAAY,CAAC;AACjF,WAAO;AAAA,EACT;AAAA,EACA,IAAO,KAAoC;AAvP7C;AAwPI,QAAI,MAAM;AACV,QAAI,OAAO,GAAG,GAAG,GAAG;AAClB,UAAI,IAAI,KAAK,GAAG;AACd,cAAM;AACN,cAAM,IAAI,GAAG;AAAA,MACf,OAAO;AACL,cAAM,IAAI,IAAI;AAAA,MAChB;AAAA,IACF;AACA,QAAI,eAAe,OAAO;AACxB,UAAI,IAAI,OAAO;AACb,aAAK,UAAU,KAAK;AAAA,UAClB,SAAS,IAAI;AAAA,UACb,OAAO,IAAI;AAAA,QACb,CAAC;AAAA,MACH,OAAO;AACL,aAAK,YAAY,GAAG,IAAI,SAAS,IAAI,SAAS,cAAc,KAAK,YAAY,CAAC;AAAA,MAChF;AACA,UAAI,KAAK,aAAa,gBAAgB;AACpC,aAAK,YAAY,OAAO,IAAI;AAAA,WAC1B,SAAI,UAAJ,mBAAW,MAAM,WAAW,IAAI,CAAC,MAAM,EAAE,KAAK;AAAA,UAC9C,cAAc,KAAK,YAAY;AAAA,QACjC;AAAA,MACF;AAAA,IACF,OAAO;AACL,WAAK,IAAI,KAAK,GAAsB;AAAA,IACtC;AACA,WAAO;AAAA,EACT;AAAA,EACA,UAAU,GAAkB;AAC1B,SAAK,YAAY,OAAO,IAAI,SAAS,GAAG,cAAc,KAAK,YAAY,CAAC;AACxE,WAAO;AAAA,EACT;AAAA,EAEA,IAAI,KAAa,QAA2D;AAC1E,QAAI,OAAO,WAAW,YAAY;AAChC,WAAK,YAAY,GAAG,IAAI,SAAS,QAAwB,cAAc,KAAK,YAAY,CAAC;AAAA,IAC3F,WAAW,OAAO,OAAO,aAAa,YAAY;AAChD,WAAK,YAAY,GAAG,IAAI,SAAS,MAAM,OAAO,SAAS,GAAG,cAAc,KAAK,YAAY,CAAC;AAAA,IAC5F,OAAO;AACL,WAAK,YAAY,GAAG,IAAI,SAAS,eAAe,cAAc,KAAK,YAAY,CAAC;AAAA,IAClF;AACA,WAAO;AAAA,EACT;AAAA,EACA,KAAK,KAAuC,OAAwB;AAClE,SAAK,UAAU,KAAK,CAAC,CAAC,KAAK;AAE3B,WAAO;AAAA,EACT;AAAA,EAEA,QAAQ,KAAoC;AAC1C,UAAM,MAA0B,IAAI,KAAK,CAAC,MAAM,OAAO,MAAM,QAAQ;AACrE,UAAM,IAAI,OAAO,CAAC,MAAM,OAAO,MAAM,QAAQ;AAC7C,UAAM,YAAY,IAAI,OAAO,CAAC,MAAM,OAAO,GAAG,CAAC,KAAK,EAAE,MAAM,CAAC;AAC7D,QAAI,UAAU,QAAQ;AACpB,WAAK,IAAI,UAAU,IAAI,CAAC,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,KAAK,IAAI,CAAC;AACzD,aAAO;AAAA,IACT;AACA,UAAM,MAAM,IACT,IAAI,CAAC,gBAAiB,OAAO,GAAG,WAAW,IAAI,YAAY,GAAG,IAAI,WAAY,EAC9E,KAAK,CAACC,SAAQ,OAAQA,KAAiB,WAAW,QAAQ;AAC7D,UAAM,MAAM,IACT,IAAI,CAAC,gBAAiB,OAAO,GAAG,WAAW,IAAI,YAAY,GAAG,IAAI,WAAY,EAC9E,KAAK,CAACC,SAAQ,OAAQA,KAAiB,WAAW,QAAQ;AAC7D,QAAI;AACJ,QAAI,OAAO,KAAK;AACd,oBAAc,EAAE,KAAK,IAAI;AAAA,IAC3B,WAAW,CAAC,OAAO,CAAC,KAAK;AACvB,oBAAc;AAAA,IAChB,WAAW,KAAK;AACd,oBAAc;AAAA,IAChB,WAAW,KAAK;AACd,oBAAc;AAAA,IAChB;AACA,QAAI,aAAa;AACf,WAAK,IAAI,OAAO,QAAQ,WAAyC;AAAA,IACnE;AACA,WAAO;AAAA,EACT;AAAA,EACA,KAAK,GAAoC;AACvC,eAAW,OAAO,OAAO,KAAK,CAAC,GAAG;AAChC,YAAM,QAAQ,EAAE,GAAG;AACnB,UAAI,iBAAiB,UAAU;AAC7B,aAAK,YAAY,GAAG,IAAI;AACxB;AAAA,MACF;AACA,UAAI,OAAO,GAAG,KAAK,GAAG;AACpB,aAAK,OAAO,KAAK,KAAK;AACtB;AAAA,MACF;AACA,WAAK,IAAI,KAAK,KAAwB;AAAA,IACxC;AACA,WAAO;AAAA,EACT;AAAA,EAEA,OAAU,KAAa,KAA+B;AACpD,QAAI,IAAI,KAAK,GAAG;AACd,WAAK,YAAY,GAAG,IAAI,SAAS,IAAI,GAAG,GAAiB,cAAc,KAAK,YAAY,CAAC;AAAA,IAC3F,OAAO;AACL,WAAK,IAAI,IAAI,IAAI,CAAC;AAAA,IACpB;AACA,WAAO;AAAA,EACT;AAAA,EAEA,IAAI,OAAgB,MAAM,OAAe;AACvC,SAAK,YAAY,GAAG,IAAI,OAAO,OAAO,cAAc,KAAK,YAAY,CAAC;AACtE,WAAO;AAAA,EACT;AAAA;AAAA,EAGA,KAAK,OAAgB,MAAM,QAAgB;AACzC,UAAM,IAAI,MAAM,iBAAiB;AAAA,EAKnC;AAAA,EAEA,IAAI,KAAgB,MAAM,OAAe;AACvC,SAAK,IAAI,KAAK,MAAM,IAAI,KAAK,GAAG,EAAE,SAAS,CAAC;AAC5C,WAAO;AAAA,EACT;AAAA,EAEQ,UAAU,KAAuC,OAAuB;AAC9E,QAAI,OAAO,QAAQ,UAAU;AAC3B,WAAK,YAAY,GAAG,IAAI,SAAS,OAAsB,cAAc,KAAK,YAAY,CAAC;AAAA,IACzF,OAAO;AACL,WAAK,KAAK,GAAG;AAAA,IACf;AAAA,EACF;AAAA,EAEA,IAAI,KAAsC,OAAwB;AAChE,SAAK,UAAU,KAAK,KAAK;AACzB,WAAO;AAAA,EACT;AAAA,EAEA,IAAI,KAAuC,OAAyB;AAClE,SAAK,UAAU,KAAK,KAAK;AAEzB,WAAO;AAAA,EACT;AAAA,EACA,IAAI,KAAa,MAAsB;AACrC,SAAK,YAAY,GAAG,IAAI,SAAS,GAAG,IAAI,MAAM,cAAc,KAAK,YAAY,CAAC;AAE9E,WAAO;AAAA,EACT;AAAA,EACA,OAAO,KAAsC,OAAwB;AACnE,SAAK,UAAU,KAAK,KAAK;AAEzB,WAAO;AAAA,EACT;AAAA,EACA,IAAI,KAAsC,OAAwB;AAChE,WAAO,KAAK,OAAO,KAAK,KAAK;AAAA,EAC/B;AAAA,EAEA,MAAM,QAAuB;AAC3B,WAAO,IAAI,QAAQ,CAAC,YAAY;AAC9B,WAAK,WAAW,OAAO,QAAW,OAAO;AAAA,IAC3C,CAAC;AAAA,EACH;AAAA,EAEA,OAAmB;AAEjB,WAAO,IAAI;AAAA,MACT,IAAI,YAAW;AAAA,QACb,WAAW,KAAK;AAAA,QAChB,KAAK,KAAK;AAAA,QACV,cAAc,KAAK;AAAA,QACnB,WAAW,KAAK;AAAA,QAChB,gBAAgB;AAAA,UACd,QAAQ,KAAK,YAAY,QAAQ;AAAA,UACjC,GAAG,KAAK;AAAA,QACV;AAAA,MACF,CAAC;AAAA,IACH;AAAA,EACF;AAAA,EAEA,iBAAiB,IAA8C;AAC7D,UAAM,MAAM,GAAG;AACf,WAAO,KAAK,KAAK,WAAW,EAAE,QAAQ,CAAC,QAAQ;AAE7C,aAAO,KAAK,YAAY,GAAG;AAAA,IAC7B,CAAC;AACD,WAAO,OAAO,KAAK,aAAa,KAAK,eAAe;AACpD,WAAO;AAAA,EACT;AAAA,EAEA,OAAO,MAAyB;AAC9B,UAAM,UAAU,KAAK,iBAAiB,MAAM;AApbhD;AAqbM,YAAM,UAAU,KAAK,aAAa;AAAA,SAChC,gBAAW,KAAK,YAAY,OAAO,CAAC,MAApC,mBAAuC;AAAA,SACvC,gBAAW,KAAK,YAAY,QAAQ,CAAC,MAArC,mBAAwC;AAAA,MAC1C;AACA,WAAK,YAAY,KAAK,IAAI,SAAS,KAAK,KAAK,GAAG,GAAG,cAAc,KAAK,YAAY,CAAC;AACnF,YAAM,MAAM,KAAK,YAAY,KAAK,EAAE,MAAM;AAC1C,UAAI,OAAO,QAAQ,YAAY,CAAC,IAAI,KAAK,EAAE,QAAQ;AACjD,eAAO,KAAK,YAAY,KAAK;AAAA,MAC/B;AACA,UAAI,QAAQ,MAAkB,KAAK,WAAW,OAAO,EAAE,GAAG,KAAK,YAAY,CAAC;AAC5E,UAAI,SAAS;AACX,cAAM,UAAU,MAAM;AACtB,aAAK,WAAW,MAAM,OAAO;AAC7B,gBAAQ,MAAkB;AAAA,MAC5B;AACA,aAAO;AAAA,IACT,CAAC;AACD,UAAM,UAAU,MAAa,IAAI,MAAM,KAAK,SAAS,OAAO,QAAQ,CAAC,CAAC;AACtE,WAAO;AAAA,MACL,aAAa,MAAM,OAAO,IAAI,QAAQ,CAAC;AAAA,MACvC,SAAS;AAAA,IACX;AAAA,EACF;AACF;AAEA,IAAM,oBAAN,MAA8C;AAAA,EAG5C,YAAY,IAAgB;AAC1B,SAAK,MAAM;AACX,SAAK,eAAe,GAAG;AAAA,EACzB;AAAA,EAEA,UAAwB;AACtB,WAAO,KAAK,IAAI,QAAQ;AAAA,EAC1B;AAAA,EAEA,SAAiB;AACf,WAAO,OAAO,KAAK,IAAI,iBAAiB,KAAK,IAAI,WAAW;AAC5D,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,aAAsC;AACpC,WAAO,EAAE,GAAG,KAAK,IAAI,YAAY;AAAA,EACnC;AAAA,EAEA,eAAe,QAA8B;AAC3C,SAAK,IAAI,aAAa,eAAe,MAAM;AAC3C,WAAO;AAAA,EACT;AAAA,EAEA,mBAAmB,IAAyB;AAC1C,SAAK,IAAI,aAAa,cAAc,EAAE;AACtC,WAAO;AAAA,EACT;AAAA,EAEA,aAAa,KAA+B;AAC1C,SAAK,IAAI,aAAa,GAAG;AACzB,WAAO;AAAA,EACT;AAAA,EAEA,YAAY,UAAiB,SAA+B;AAC1D,SAAK,IAAI,aAAa,YAAY,OAAO,GAAG,OAAO;AACnD,WAAO;AAAA,EACT;AAAA,EACA,aAAa,UAAiB,SAA+B;AAC3D,SAAK,IAAI,aAAa,YAAY,OAAO,GAAG,OAAO;AACnD,WAAO;AAAA,EACT;AAAA,EAEA,OAAO,KAAyB;AAC9B,SAAK,IAAI,OAAO,GAAG;AACnB,WAAO;AAAA,EACT;AAAA,EACA,YAAY,SAA4C;AACtD,SAAK,IAAI,SAAS,GAAG,OAAO;AAC5B,WAAO;AAAA,EACT;AAAA,EAEA,QAAQ,KAAwC;AAC9C,SAAK,IAAI,KAAK,GAAG,GAAG;AACpB,WAAO;AAAA,EACT;AAAA,EACA,KAAK,GAAwC;AAC3C,SAAK,IAAI,KAAK,CAAC;AACf,WAAO;AAAA,EACT;AAAA,EAEA,IAAI,KAAsC,OAA4B;AACpE,SAAK,IAAI,IAAI,KAAK,KAAK;AACvB,WAAO;AAAA,EACT;AAAA,EAEA,IAAI,OAAgB,KAA0B;AAC5C,SAAK,IAAI,IAAI,OAAO,GAAG;AACvB,WAAO;AAAA,EACT;AAAA,EAEA,KAAK,OAAgB,KAA0B;AAC7C,SAAK,IAAI,KAAK,OAAO,GAAG;AACxB,WAAO;AAAA,EACT;AAAA,EAEA,IAAI,KAAa,QAA+C;AAC9D,SAAK,IAAI,IAAI,KAAK,MAAM;AACxB,WAAO;AAAA,EACT;AAAA,EACA,KAAK,KAAuC,OAA6B;AACvE,SAAK,IAAI,KAAK,KAAK,KAAK;AACxB,WAAO;AAAA,EACT;AAAA,EACA,OAAU,KAAa,KAAmC;AACxD,SAAK,IAAI,OAAO,KAAK,GAAG;AACxB,WAAO;AAAA,EACT;AAAA,EACA,IAAI,KAAgB,KAA0B;AAC5C,SAAK,IAAI,IAAI,KAAK,GAAG;AACrB,WAAO;AAAA,EACT;AAAA,EACA,IAAI,KAAsC,OAA4B;AACpE,SAAK,IAAI,IAAI,KAAK,KAAK;AACvB,WAAO;AAAA,EACT;AAAA,EAEA,MAAkB;AAChB,SAAK,IAAI,IAAI;AACb,WAAO;AAAA,EACT;AAAA,EAEA,UAAU,OAA0B;AAClC,SAAK,IAAI,UAAU,KAAK;AACxB,WAAO;AAAA,EACT;AAAA,EAEA,QAAoB;AAClB,SAAK,IAAI,MAAM;AACf,WAAO;AAAA,EACT;AAAA,EACA,OAAmB;AACjB,SAAK,IAAI,MAAM;AACf,WAAO;AAAA,EACT;AAAA,EACA,QAAoB;AAClB,SAAK,IAAI,MAAM;AACf,WAAO;AAAA,EACT;AAAA,EACA,IAAI,KAA0B;AAC5B,SAAK,IAAI,IAAI,GAAG;AAChB,WAAO;AAAA,EACT;AAAA,EACA,OAAmB;AACjB,SAAK,IAAI,KAAK;AACd,WAAO;AAAA,EACT;AAAA,EACA,YAAwB;AACtB,SAAK,IAAI,UAAU;AACnB,WAAO;AAAA,EACT;AAAA,EACA,IAAO,KAAuC,OAAyC;AACrF,SAAK,IAAI,IAAI,KAAK,KAAK;AACvB,WAAO;AAAA,EACT;AAAA,EACA,IAAI,KAAa,MAA0B;AACzC,SAAK,IAAI,IAAI,KAAK,IAAI;AACtB,WAAO;AAAA,EACT;AAAA,EACA,OAAO,KAAsC,OAA4B;AACvE,SAAK,IAAI,OAAO,KAAK,KAAK;AAC1B,WAAO;AAAA,EACT;AACF;;;AIplBO,SAAS,WAAW,QAKN;AACnB,QAAM,KAAK,IAAI,aAAa,iCAAQ,IAAI;AACxC,MAAI,WAAW,CAAC,YAAY;AAC5B,MAAI,QAAO,iCAAQ,gBAAe,UAAU;AAC1C,eAAW,CAAC,iCAAQ,UAAU;AAAA,EAChC,WAAW,MAAM,QAAQ,iCAAQ,UAAU,GAAG;AAC5C,eAAW,CAAC,GAAG,OAAO,YAAY,GAAG,QAAQ;AAAA,EAC/C;AACA,QAAM,SAAS,IAAI,WAAW;AAAA,IAC5B,KAAK;AAAA,IACL,KAAK,iCAAQ;AAAA,IACb,cAAc,IAAI,iBAAiB;AAAA,EACrC,CAAC,EACE,KAAK,EACL,OAAO,SAAS,CAAC,CAAC,EAClB,OAAO;AACV,MAAI,EAAC,iCAAQ,eAAc;AACzB,WAAO,SAAS,GAAG,QAAQ;AAAA,EAC7B;AACA,SAAO;AAAA,IACL,cAAc;AAAA,IACd;AAAA,EACF;AACF;","names":["e","key","from","req","res"]}
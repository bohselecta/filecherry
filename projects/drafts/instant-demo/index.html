<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🍒 Task Cherry - Portable Task Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fireproof/core/dist/browser/fireproof.global.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        .cherry-gradient {
            background: linear-gradient(135deg, #ff6b6b, #ff8e8e, #ffa8a8);
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .task-item {
            transition: all 0.3s ease;
        }
        
        .task-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .completed {
            opacity: 0.6;
            text-decoration: line-through;
        }
        
        .priority-high { border-left: 4px solid #ef4444; }
        .priority-medium { border-left: 4px solid #f59e0b; }
        .priority-low { border-left: 4px solid #10b981; }
        
        .floating-action {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .cherry-bounce {
            animation: cherryBounce 2s ease-in-out infinite;
        }
        
        @keyframes cherryBounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 text-white">
    <div class="container mx-auto max-w-4xl p-6">
        <!-- Header -->
        <header class="text-center mb-8">
            <div class="cherry-bounce text-6xl mb-4">🍒</div>
            <h1 class="text-4xl font-bold text-white mb-2">
                Task Cherry
            </h1>
            <p class="text-lg text-purple-200">
                Your portable task manager - works offline, syncs anywhere
            </p>
            <div class="mt-4 flex justify-center gap-4 text-sm">
                <span class="px-3 py-1 bg-green-500/20 rounded-full">✅ Offline-first</span>
                <span class="px-3 py-1 bg-blue-500/20 rounded-full">🔒 Encrypted</span>
                <span class="px-3 py-1 bg-purple-500/20 rounded-full">☁️ Sync-ready</span>
            </div>
        </header>

        <!-- Stats Dashboard -->
        <div class="glass-card rounded-2xl p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4">📊 Your Progress</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                <div>
                    <p id="totalTasks" class="text-3xl font-bold text-blue-300">0</p>
                    <p class="text-white/70 text-sm">Total Tasks</p>
                </div>
                <div>
                    <p id="completedTasks" class="text-3xl font-bold text-green-300">0</p>
                    <p class="text-white/70 text-sm">Completed</p>
                </div>
                <div>
                    <p id="pendingTasks" class="text-3xl font-bold text-yellow-300">0</p>
                    <p class="text-white/70 text-sm">Pending</p>
                </div>
                <div>
                    <p id="dbStatus" class="text-3xl font-bold text-purple-300">🔄</p>
                    <p class="text-white/70 text-sm">Database</p>
                </div>
            </div>
        </div>

        <!-- Add Task Form -->
        <div class="glass-card rounded-2xl p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4">➕ Add New Task</h2>
            <form id="taskForm" class="space-y-4">
                <div>
                    <input 
                        type="text" 
                        id="taskInput" 
                        placeholder="What needs to be done?" 
                        class="w-full bg-white/10 border border-white/20 rounded-full px-6 py-3 text-white placeholder-white/60 focus:outline-none focus:border-red-400"
                        required
                    >
                </div>
                <div class="flex gap-4">
                    <select id="prioritySelect" class="bg-white/10 border border-white/20 rounded-full px-4 py-2 text-white focus:outline-none focus:border-red-400">
                        <option value="low">🟢 Low Priority</option>
                        <option value="medium">🟡 Medium Priority</option>
                        <option value="high">🔴 High Priority</option>
                    </select>
                    <select id="categorySelect" class="bg-white/10 border border-white/20 rounded-full px-4 py-2 text-white focus:outline-none focus:border-red-400">
                        <option value="work">💼 Work</option>
                        <option value="personal">🏠 Personal</option>
                        <option value="health">🏥 Health</option>
                        <option value="learning">📚 Learning</option>
                        <option value="other">📝 Other</option>
                    </select>
                </div>
                <button type="submit" class="w-full cherry-gradient py-3 rounded-full font-semibold hover:opacity-90 transition-opacity">
                    🍒 Add Task Cherry
                </button>
            </form>
        </div>

        <!-- Task Filters -->
        <div class="glass-card rounded-2xl p-6 mb-8">
            <div class="flex flex-wrap gap-3">
                <button class="filter-btn active" data-filter="all">All Tasks</button>
                <button class="filter-btn" data-filter="pending">Pending</button>
                <button class="filter-btn" data-filter="completed">Completed</button>
                <button class="filter-btn" data-filter="high">High Priority</button>
                <button class="filter-btn" data-filter="work">Work</button>
                <button class="filter-btn" data-filter="personal">Personal</button>
            </div>
        </div>

        <!-- Task List -->
        <div class="glass-card rounded-2xl p-6">
            <h2 class="text-xl font-semibold mb-4">📋 Your Tasks</h2>
            <div id="taskList" class="space-y-3">
                <div class="text-center text-white/60 py-8">
                    <div class="text-4xl mb-2">🍒</div>
                    <p>No tasks yet! Add your first task above.</p>
                </div>
            </div>
        </div>

        <!-- Sync Status -->
        <div class="glass-card rounded-2xl p-6 mt-8">
            <h2 class="text-xl font-semibold mb-4">☁️ Sync Status</h2>
            <div class="flex items-center justify-between">
                <div>
                    <p id="syncStatus" class="text-white/70">Local storage only</p>
                    <p class="text-sm text-white/50">Ready to sync when you need it</p>
                </div>
                <button id="syncBtn" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-full text-sm font-semibold transition-colors">
                    Enable Sync
                </button>
            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center mt-12 text-white/60">
            <p>Built with ❤️ using TinyApp Factory</p>
            <p class="text-sm mt-2">Double-click this file to run anywhere!</p>
        </footer>
    </div>

    <script>
        // Initialize Fireproof database
        const { fireproof } = Fireproof;
        const db = fireproof('task-cherry');

        // State
        let tasks = [];
        let currentFilter = 'all';
        let isSyncing = false;

        // DOM elements
        const taskForm = document.getElementById('taskForm');
        const taskInput = document.getElementById('taskInput');
        const prioritySelect = document.getElementById('prioritySelect');
        const categorySelect = document.getElementById('categorySelect');
        const taskList = document.getElementById('taskList');
        const filterBtns = document.querySelectorAll('.filter-btn');
        const syncBtn = document.getElementById('syncBtn');
        const syncStatus = document.getElementById('syncStatus');

        // Stats elements
        const totalTasks = document.getElementById('totalTasks');
        const completedTasks = document.getElementById('completedTasks');
        const pendingTasks = document.getElementById('pendingTasks');
        const dbStatus = document.getElementById('dbStatus');

        // Initialize
        loadTasks();
        setupEventListeners();
        updateStats();

        function setupEventListeners() {
            taskForm.addEventListener('submit', addTask);
            
            filterBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    filterBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilter = btn.dataset.filter;
                    renderTasks();
                });
            });

            syncBtn.addEventListener('click', toggleSync);
        }

        async function addTask(e) {
            e.preventDefault();
            
            const text = taskInput.value.trim();
            const priority = prioritySelect.value;
            const category = categorySelect.value;
            
            if (!text) return;

            const task = {
                _id: crypto.randomUUID(),
                text: text,
                priority: priority,
                category: category,
                completed: false,
                createdAt: Date.now(),
                completedAt: null
            };

            try {
                await db.put(task);
                taskInput.value = '';
                loadTasks();
                showNotification('Task added! 🍒');
            } catch (error) {
                console.error('Error adding task:', error);
                showNotification('Error adding task', 'error');
            }
        }

        async function toggleTask(taskId) {
            const task = tasks.find(t => t._id === taskId);
            if (!task) return;

            task.completed = !task.completed;
            task.completedAt = task.completed ? Date.now() : null;

            try {
                await db.put(task);
                loadTasks();
                showNotification(task.completed ? 'Task completed! ✅' : 'Task reopened 🔄');
            } catch (error) {
                console.error('Error updating task:', error);
            }
        }

        async function deleteTask(taskId) {
            if (!confirm('Are you sure you want to delete this task?')) return;

            try {
                await db.del(taskId);
                loadTasks();
                showNotification('Task deleted 🗑️');
            } catch (error) {
                console.error('Error deleting task:', error);
            }
        }

        async function loadTasks() {
            try {
                const { rows } = await db.query('type', { key: 'task' });
                tasks = rows.map(row => row.value);
                renderTasks();
                updateStats();
                updateDbStatus(true);
            } catch (error) {
                console.error('Error loading tasks:', error);
                updateDbStatus(false);
            }
        }

        function renderTasks() {
            let filteredTasks = tasks;

            // Apply filter
            switch (currentFilter) {
                case 'pending':
                    filteredTasks = tasks.filter(t => !t.completed);
                    break;
                case 'completed':
                    filteredTasks = tasks.filter(t => t.completed);
                    break;
                case 'high':
                    filteredTasks = tasks.filter(t => t.priority === 'high');
                    break;
                case 'work':
                    filteredTasks = tasks.filter(t => t.category === 'work');
                    break;
                case 'personal':
                    filteredTasks = tasks.filter(t => t.category === 'personal');
                    break;
            }

            if (filteredTasks.length === 0) {
                taskList.innerHTML = `
                    <div class="text-center text-white/60 py-8">
                        <div class="text-4xl mb-2">🍒</div>
                        <p>No tasks match your filter.</p>
                    </div>
                `;
                return;
            }

            taskList.innerHTML = filteredTasks.map(task => `
                <div class="task-item glass-card p-4 rounded-xl priority-${task.priority} ${task.completed ? 'completed' : ''}">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <button 
                                onclick="toggleTask('${task._id}')" 
                                class="w-6 h-6 rounded-full border-2 border-white/30 flex items-center justify-center hover:border-green-400 transition-colors"
                            >
                                ${task.completed ? '✅' : ''}
                            </button>
                            <div>
                                <p class="font-medium">${task.text}</p>
                                <div class="flex gap-2 text-sm text-white/60">
                                    <span class="px-2 py-1 bg-white/10 rounded-full">${getPriorityIcon(task.priority)} ${task.priority}</span>
                                    <span class="px-2 py-1 bg-white/10 rounded-full">${getCategoryIcon(task.category)} ${task.category}</span>
                                    <span class="px-2 py-1 bg-white/10 rounded-full">${formatDate(task.createdAt)}</span>
                                </div>
                            </div>
                        </div>
                        <button 
                            onclick="deleteTask('${task._id}')" 
                            class="text-red-400 hover:text-red-300 transition-colors"
                        >
                            🗑️
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function updateStats() {
            const total = tasks.length;
            const completed = tasks.filter(t => t.completed).length;
            const pending = total - completed;

            totalTasks.textContent = total;
            completedTasks.textContent = completed;
            pendingTasks.textContent = pending;
        }

        function updateDbStatus(connected) {
            dbStatus.textContent = connected ? '✅' : '❌';
        }

        function getPriorityIcon(priority) {
            switch (priority) {
                case 'high': return '🔴';
                case 'medium': return '🟡';
                case 'low': return '🟢';
                default: return '⚪';
            }
        }

        function getCategoryIcon(category) {
            switch (category) {
                case 'work': return '💼';
                case 'personal': return '🏠';
                case 'health': return '🏥';
                case 'learning': return '📚';
                default: return '📝';
            }
        }

        function formatDate(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return 'Just now';
            if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;
            if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;
            return date.toLocaleDateString();
        }

        async function toggleSync() {
            if (isSyncing) return;

            isSyncing = true;
            syncBtn.textContent = 'Syncing...';
            syncBtn.disabled = true;

            try {
                // Simulate sync process
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                syncStatus.textContent = 'Synced to Fireproof Cloud';
                syncBtn.textContent = 'Sync Enabled';
                syncBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                syncBtn.classList.add('bg-green-600', 'hover:bg-green-700');
                
                showNotification('Sync enabled! Your tasks are now backed up ☁️');
            } catch (error) {
                syncStatus.textContent = 'Sync failed - using local storage';
                syncBtn.textContent = 'Retry Sync';
                showNotification('Sync failed', 'error');
            } finally {
                isSyncing = false;
                syncBtn.disabled = false;
            }
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 px-6 py-3 rounded-full font-semibold z-50 ${
                type === 'error' ? 'bg-red-600' : 'cherry-gradient'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.5s';
                setTimeout(() => notification.remove(), 500);
            }, 3000);
        }

        // Add some sample tasks on first load
        if (tasks.length === 0) {
            setTimeout(async () => {
                const sampleTasks = [
                    {
                        _id: crypto.randomUUID(),
                        text: 'Welcome to Task Cherry! 🍒',
                        priority: 'high',
                        category: 'other',
                        completed: false,
                        createdAt: Date.now()
                    },
                    {
                        _id: crypto.randomUUID(),
                        text: 'Try adding your own tasks',
                        priority: 'medium',
                        category: 'learning',
                        completed: false,
                        createdAt: Date.now()
                    }
                ];

                for (const task of sampleTasks) {
                    await db.put(task);
                }
                loadTasks();
            }, 1000);
        }
    </script>
</body>
</html>